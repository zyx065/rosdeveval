compilation.log: |
  Starting >>> nav2_route
  --- stderr: nav2_route
  /root/repos/nav_ws/src/nav2_route/src/plugins/route_operations/collision_monitor.cpp: In member function ‘bool nav2_route::CollisionMonitor::isInCollision(const nav2_route::CollisionMonitor::LineSegment&)’:
  /root/repos/nav_ws/src/nav2_route/src/plugins/route_operations/collision_monitor.cpp:240:35: error: ‘const struct nav2_route::CollisionMonitor::LineSegment’ has no member named ‘start’
    240 |     if (!costmap->worldToMap(line.start.x, line.start.y, start_x, start_y) ||
        |                                   ^~~~~
  /root/repos/nav_ws/src/nav2_route/src/plugins/route_operations/collision_monitor.cpp:240:49: error: ‘const struct nav2_route::CollisionMonitor::LineSegment’ has no member named ‘start’
    240 |     if (!costmap->worldToMap(line.start.x, line.start.y, start_x, start_y) ||
        |                                                 ^~~~~
  /root/repos/nav_ws/src/nav2_route/src/plugins/route_operations/collision_monitor.cpp:241:35: error: ‘const struct nav2_route::CollisionMonitor::LineSegment’ has no member named ‘end’
    241 |         !costmap->worldToMap(line.end.x, line.end.y, end_x, end_y)) {
        |                                   ^~~
  /root/repos/nav_ws/src/nav2_route/src/plugins/route_operations/collision_monitor.cpp:241:47: error: ‘const struct nav2_route::CollisionMonitor::LineSegment’ has no member named ‘end’
    241 |         !costmap->worldToMap(line.end.x, line.end.y, end_x, end_y)) {
        |                                               ^~~
  /root/repos/nav_ws/src/nav2_route/src/plugins/route_operations/collision_monitor.cpp:232:18: error: unused variable ‘costmap_width’ [-Werror=unused-variable]
    232 |     unsigned int costmap_width = costmap->getSizeInCellsX();
        |                  ^~~~~~~~~~~~~
  /root/repos/nav_ws/src/nav2_route/src/plugins/route_operations/collision_monitor.cpp:233:18: error: unused variable ‘costmap_height’ [-Werror=unused-variable]
    233 |     unsigned int costmap_height = costmap->getSizeInCellsY();
        |                  ^~~~~~~~~~~~~~
  /root/repos/nav_ws/src/nav2_route/src/plugins/route_operations/collision_monitor.cpp:234:12: error: unused variable ‘resolution’ [-Werror=unused-variable]
    234 |     double resolution = costmap->getResolution();
        |            ^~~~~~~~~~
  /root/repos/nav_ws/src/nav2_route/src/plugins/route_operations/collision_monitor.cpp:235:12: error: unused variable ‘origin_x’ [-Werror=unused-variable]
    235 |     double origin_x = costmap->getOriginX();
        |            ^~~~~~~~
  /root/repos/nav_ws/src/nav2_route/src/plugins/route_operations/collision_monitor.cpp:236:12: error: unused variable ‘origin_y’ [-Werror=unused-variable]
    236 |     double origin_y = costmap->getOriginY();
        |            ^~~~~~~~
  cc1plus: all warnings being treated as errors
  gmake[2]: *** [CMakeFiles/route_operations.dir/build.make:118: CMakeFiles/route_operations.dir/src/plugins/route_operations/collision_monitor.cpp.o] Error 1
  gmake[1]: *** [CMakeFiles/Makefile2:292: CMakeFiles/route_operations.dir/all] Error 2
  gmake: *** [Makefile:146: all] Error 2
  ---
  Failed   <<< nav2_route [3.74s, exited with code 2]

  Summary: 0 packages finished [4.06s]
    1 package failed: nav2_route
    1 package had stderr output: nav2_route
generate_code.cpp: |-
  bool CollisionMonitor::isInCollision(const LineSegment & line)
  {
      // Ensure the costmap is available
      if (!costmap_) {
          RCLCPP_WARN(logger_, "Costmap is not available.");
          return false;
      }

      // Get the costmap dimensions and resolution
      auto costmap = costmap_.get();
      unsigned int costmap_width = costmap->getSizeInCellsX();
      unsigned int costmap_height = costmap->getSizeInCellsY();
      double resolution = costmap->getResolution();
      double origin_x = costmap->getOriginX();
      double origin_y = costmap->getOriginY();

      // Convert the line segment to costmap coordinates
      unsigned int start_x, start_y, end_x, end_y;
      if (!costmap->worldToMap(line.start.x, line.start.y, start_x, start_y) ||
          !costmap->worldToMap(line.end.x, line.end.y, end_x, end_y)) {
          RCLCPP_WARN(logger_, "Line segment is out of costmap bounds.");
          return false;
      }

      // Bresenham's line algorithm to iterate through the line segment
      int dx = abs(static_cast<int>(end_x) - static_cast<int>(start_x));
      int dy = abs(static_cast<int>(end_y) - static_cast<int>(start_y));
      int sx = (start_x < end_x) ? 1 : -1;
      int sy = (start_y < end_y) ? 1 : -1;
      int err = dx - dy;

      unsigned int x = start_x;
      unsigned int y = start_y;

      while (true) {
          // Check the cost at the current cell
          unsigned char cost = costmap->getCost(x, y);
          if (cost >= max_cost_) {
              return true; // Collision detected
          }

          // If we've reached the end point, break
          if (x == end_x && y == end_y) {
              break;
          }

          // Move to the next cell
          int e2 = 2 * err;
          if (e2 > -dy) {
              err -= dy;
              x += sx;
          }
          if (e2 < dx) {
              err += dx;
              y += sy;
          }
      }

      return false; // No collision detected
  }
ground_truth.cpp: |-
  bool CollisionMonitor::isInCollision(const LineSegment & line)
  {
    nav2_util::LineIterator iter(line.x0, line.y0, line.x1, line.y1);
    for (; iter.isValid(); ) {
      float cost = static_cast<float>(costmap_->getCost(iter.getX(), iter.getY()));
      if (cost >= max_cost_ && cost != 255.0 /*unknown*/) {
        return true;
      }

      // Advance the iterator by the check resolution on the edge, pruning to a coarse resolution
      for (unsigned int i = 0; i < check_resolution_; i++) {
        iter.advance();
      }
    }
    return false;
  }
