compilation.log: |
  Starting >>> autoware_lane_departure_checker
  --- stderr: autoware_lane_departure_checker
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp: In function ‘autoware::lane_departure_checker::utils::TrajectoryPoints autoware::lane_departure_checker::utils::cutTrajectory(const TrajectoryPoints&, double)’:
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:78:32: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘x’
     78 |         double dx = next_point.x - current_point.x;
        |                                ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:78:50: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘x’
     78 |         double dx = next_point.x - current_point.x;
        |                                                  ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:79:32: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘y’
     79 |         double dy = next_point.y - current_point.y;
        |                                ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:79:50: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘y’
     79 |         double dy = next_point.y - current_point.y;
        |                                                  ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:92:32: error: ‘using TrajectoryPoint = struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ {aka ‘struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’} has no member named ‘x’
     92 |             interpolated_point.x = current_point.x + interpolation_ratio * dx;
        |                                ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:92:50: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘x’
     92 |             interpolated_point.x = current_point.x + interpolation_ratio * dx;
        |                                                  ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:93:32: error: ‘using TrajectoryPoint = struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ {aka ‘struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’} has no member named ‘y’
     93 |             interpolated_point.y = current_point.y + interpolation_ratio * dy;
        |                                ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:93:50: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘y’
     93 |             interpolated_point.y = current_point.y + interpolation_ratio * dy;
        |                                                  ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:94:32: error: ‘using TrajectoryPoint = struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ {aka ‘struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’} has no member named ‘z’
     94 |             interpolated_point.z = current_point.z + interpolation_ratio * (next_point.z - current_point.z);
        |                                ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:94:50: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘z’
     94 |             interpolated_point.z = current_point.z + interpolation_ratio * (next_point.z - current_point.z);
        |                                                  ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:94:88: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘z’
     94 |             interpolated_point.z = current_point.z + interpolation_ratio * (next_point.z - current_point.z);
        |                                                                                        ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:94:106: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘z’
     94 |             interpolated_point.z = current_point.z + interpolation_ratio * (next_point.z - current_point.z);
        |                                                                                                          ^
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:95:32: error: ‘using TrajectoryPoint = struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ {aka ‘struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’} has no member named ‘velocity’
     95 |             interpolated_point.velocity = current_point.velocity + interpolation_ratio * (next_point.velocity - current_point.velocity);
        |                                ^~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:95:57: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘velocity’
     95 |             interpolated_point.velocity = current_point.velocity + interpolation_ratio * (next_point.velocity - current_point.velocity);
        |                                                         ^~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:95:102: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘velocity’
     95 |             interpolated_point.velocity = current_point.velocity + interpolation_ratio * (next_point.velocity - current_point.velocity);
        |                                                                                                      ^~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/control/autoware_lane_departure_checker/src/lane_departure_checker_node/utils.cpp:95:127: error: ‘const struct autoware_planning_msgs::msg::TrajectoryPoint_<std::allocator<void> >’ has no member named ‘velocity’
     95 |             interpolated_point.velocity = current_point.velocity + interpolation_ratio * (next_point.velocity - current_point.velocity);
        |                                                                                                                               ^~~~~~~~
  gmake[2]: *** [CMakeFiles/autoware_lane_departure_checker.dir/build.make:104: CMakeFiles/autoware_lane_departure_checker.dir/src/lane_departure_checker_node/utils.cpp.o] Error 1
  gmake[1]: *** [CMakeFiles/Makefile2:159: CMakeFiles/autoware_lane_departure_checker.dir/all] Error 2
  gmake: *** [Makefile:146: all] Error 2
  ---
  Failed   <<< autoware_lane_departure_checker [7.82s, exited with code 2]

  Summary: 0 packages finished [9.35s]
    1 package failed: autoware_lane_departure_checker
    1 package had stderr output: autoware_lane_departure_checker
generate_code.cpp: |-
  TrajectoryPoints cutTrajectory(const TrajectoryPoints & trajectory, const double length)
  {
      // Check if the input trajectory is empty or the desired length is non-positive
      if (trajectory.empty() || length <= 0.0) {
          return TrajectoryPoints(); // Return an empty trajectory
      }

      TrajectoryPoints cut_trajectory;
      double accumulated_length = 0.0;

      for (size_t i = 0; i < trajectory.size() - 1; ++i) {
          const auto & current_point = trajectory[i];
          const auto & next_point = trajectory[i + 1];

          // Add the current point to the cut trajectory
          cut_trajectory.push_back(current_point);

          // Calculate the distance between the current and next points
          double dx = next_point.x - current_point.x;
          double dy = next_point.y - current_point.y;
          double segment_length = std::sqrt(dx * dx + dy * dy);

          // Update the accumulated length
          accumulated_length += segment_length;

          // Check if the accumulated length exceeds the desired length
          if (accumulated_length >= length) {
              // Interpolate the last point to match the exact desired length
              double excess_length = accumulated_length - length;
              double interpolation_ratio = (segment_length - excess_length) / segment_length;

              TrajectoryPoint interpolated_point;
              interpolated_point.x = current_point.x + interpolation_ratio * dx;
              interpolated_point.y = current_point.y + interpolation_ratio * dy;
              interpolated_point.z = current_point.z + interpolation_ratio * (next_point.z - current_point.z);
              interpolated_point.velocity = current_point.velocity + interpolation_ratio * (next_point.velocity - current_point.velocity);

              cut_trajectory.push_back(interpolated_point);
              break;
          }
      }

      return cut_trajectory;
  }
ground_truth.cpp: |-
  TrajectoryPoints cutTrajectory(const TrajectoryPoints & trajectory, const double length)
  {
    if (trajectory.empty()) {
      return {};
    }

    TrajectoryPoints cut;

    double total_length = 0.0;
    auto last_point = autoware::universe_utils::fromMsg(trajectory.front().pose.position);
    auto end_it = std::next(trajectory.cbegin());
    for (; end_it != trajectory.cend(); ++end_it) {
      const auto remain_distance = length - total_length;

      // Over length
      if (remain_distance <= 0) {
        break;
      }

      const auto & new_pose = end_it->pose;
      const auto new_point = autoware::universe_utils::fromMsg(new_pose.position);
      const auto points_distance = boost::geometry::distance(last_point.to_2d(), new_point.to_2d());

      // Require interpolation
      if (remain_distance <= points_distance) {
        const Eigen::Vector3d p_interpolated =
          last_point + remain_distance * (new_point - last_point).normalized();

        TrajectoryPoint p;
        p.pose.position.x = p_interpolated.x();
        p.pose.position.y = p_interpolated.y();
        p.pose.position.z = p_interpolated.z();
        p.pose.orientation = new_pose.orientation;

        cut.push_back(p);
        break;
      }

      total_length += points_distance;
      last_point = new_point;
    }
    cut.insert(cut.begin(), trajectory.begin(), end_it);

    return cut;
  }
