compilation.log: |
  Starting >>> autoware_motion_utils
  Finished <<< autoware_motion_utils [18.6s]

  Summary: 1 package finished [20.0s]
generate_code.cpp: "bool VehicleStopCheckerBase::isVehicleStopped(const double stop_duration)\
  \ const\n{\n    // Check if the twist buffer is empty\n    if (twist_buffer_.empty())\
  \ {\n        return false;\n    }\n\n    // Get the current time\n    const rclcpp::Time\
  \ current_time = clock_->now();\n\n    // Iterate through the twist buffer to check\
  \ stop conditions\n    for (const auto & twist : twist_buffer_) {\n        // Calculate\
  \ the time difference between the current time and the twist timestamp\n       \
  \ const double time_diff = (current_time - twist.header.stamp).seconds();\n\n  \
  \      // If the time difference exceeds the stop duration, break the loop\n   \
  \     if (time_diff > stop_duration) {\n            break;\n        }\n\n      \
  \  // Check if the vehicle is moving (non-zero linear or angular velocity)\n   \
  \     if (std::abs(twist.twist.linear.x) > 1e-3 || \n            std::abs(twist.twist.linear.y)\
  \ > 1e-3 || \n            std::abs(twist.twist.linear.z) > 1e-3 || \n          \
  \  std::abs(twist.twist.angular.x) > 1e-3 || \n            std::abs(twist.twist.angular.y)\
  \ > 1e-3 || \n            std::abs(twist.twist.angular.z) > 1e-3) {\n          \
  \  return false;\n        }\n    }\n\n    // If all velocities are zero within the\
  \ stop duration, the vehicle is stopped\n    return true;\n}"
ground_truth.cpp: |-
  bool VehicleStopCheckerBase::isVehicleStopped(const double stop_duration) const
  {
    if (twist_buffer_.empty()) {
      return false;
    }

    constexpr double squared_stop_velocity = 1e-3 * 1e-3;
    const auto now = clock_->now();

    const auto time_buffer_back = now - twist_buffer_.back().header.stamp;
    if (time_buffer_back.seconds() < stop_duration) {
      return false;
    }

    // Get velocities within stop_duration
    for (const auto & velocity : twist_buffer_) {
      double x = velocity.twist.linear.x;
      double y = velocity.twist.linear.y;
      double z = velocity.twist.linear.z;
      double v = (x * x) + (y * y) + (z * z);
      if (squared_stop_velocity <= v) {
        return false;
      }

      const auto time_diff = now - velocity.header.stamp;
      if (time_diff.seconds() >= stop_duration) {
        break;
      }
    }

    return true;
  }
