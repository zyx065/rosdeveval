compilation.log: |
  Starting >>> nav2_velocity_smoother
  Finished <<< nav2_velocity_smoother [0.24s]

  Summary: 1 package finished [0.48s]
generate_code.cpp: |-
  double VelocitySmoother::findEtaConstraint(
    const double v_curr, const double v_cmd, const double accel, const double decel)
  {
    // Calculate the maximum allowed velocity change per smoothing cycle
    double max_accel_change = accel / smoothing_frequency_;
    double max_decel_change = decel / smoothing_frequency_;

    // Calculate the actual velocity change required
    double velocity_change = v_cmd - v_curr;

    // Check if the velocity change exceeds acceleration constraints
    if (velocity_change > max_accel_change) {
      return max_accel_change / velocity_change; // Scaling factor for acceleration constraint
    }

    // Check if the velocity change exceeds deceleration constraints
    if (velocity_change < -max_decel_change) {
      return -max_decel_change / velocity_change; // Scaling factor for deceleration constraint
    }

    // If within constraints, return -1.0 indicating no scaling needed
    return -1.0;
  }
ground_truth.cpp: |-
  double VelocitySmoother::findEtaConstraint(
    const double v_curr, const double v_cmd, const double accel, const double decel)
  {
    // Exploiting vector scaling properties
    double dv = v_cmd - v_curr;

    double v_component_max;
    double v_component_min;

    // Accelerating if magnitude of v_cmd is above magnitude of v_curr
    // and if v_cmd and v_curr have the same sign (i.e. speed is NOT passing through 0.0)
    // Decelerating otherwise
    if (abs(v_cmd) >= abs(v_curr) && v_curr * v_cmd >= 0.0) {
      v_component_max = accel / smoothing_frequency_;
      v_component_min = -accel / smoothing_frequency_;
    } else {
      v_component_max = -decel / smoothing_frequency_;
      v_component_min = decel / smoothing_frequency_;
    }

    if (dv > v_component_max) {
      return v_component_max / dv;
    }

    if (dv < v_component_min) {
      return v_component_min / dv;
    }

    return -1.0;
  }
