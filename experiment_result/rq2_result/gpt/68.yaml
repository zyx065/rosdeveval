compilation.log: |
  Starting >>> autoware_euclidean_cluster
  --- stderr: autoware_euclidean_cluster
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_euclidean_cluster/src/voxel_grid_based_euclidean_cluster_node.cpp: In member function ‘void autoware::euclidean_cluster::VoxelGridBasedEuclideanClusterNode::onPointCloud(sensor_msgs::msg::PointCloud2_<std::allocator<void> >::ConstSharedPtr)’:
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_euclidean_cluster/src/voxel_grid_based_euclidean_cluster_node.cpp:65:13: error: ‘autoware::perception’ has not been declared
     65 |   autoware::perception::cluster::EuclideanClusterResult cluster_result;
        |             ^~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_euclidean_cluster/src/voxel_grid_based_euclidean_cluster_node.cpp:66:34: error: ‘cluster_result’ was not declared in this scope; did you mean ‘cluster_pub_’?
     66 |   cluster_->cluster(input_cloud, cluster_result);
        |                                  ^~~~~~~~~~~~~~
        |                                  cluster_pub_
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_euclidean_cluster/src/voxel_grid_based_euclidean_cluster_node.cpp:70:13: error: ‘using element_type = class autoware::euclidean_cluster::VoxelGridBasedEuclideanCluster’ {aka ‘class autoware::euclidean_cluster::VoxelGridBasedEuclideanCluster’} has no member named ‘convertToDetectedObjectsWithFeature’
     70 |   cluster_->convertToDetectedObjectsWithFeature(cluster_result, output_msg);
        |             ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_euclidean_cluster/src/voxel_grid_based_euclidean_cluster_node.cpp:88:23: error: ‘class autoware::universe_utils::DebugPublisher’ has no member named ‘publishDebugInfo’
     88 |     debug_publisher_->publishDebugInfo(cluster_result, input_msg->header);
        |                       ^~~~~~~~~~~~~~~~
  gmake[2]: *** [CMakeFiles/autoware_euclidean_cluster_voxel_grid_node_core.dir/build.make:76: CMakeFiles/autoware_euclidean_cluster_voxel_grid_node_core.dir/src/voxel_grid_based_euclidean_cluster_node.cpp.o] Error 1
  gmake[1]: *** [CMakeFiles/Makefile2:244: CMakeFiles/autoware_euclidean_cluster_voxel_grid_node_core.dir/all] Error 2
  gmake: *** [Makefile:146: all] Error 2
  ---
  Failed   <<< autoware_euclidean_cluster [7.11s, exited with code 2]

  Summary: 0 packages finished [8.37s]
    1 package failed: autoware_euclidean_cluster
    1 package had stderr output: autoware_euclidean_cluster
generate_code.cpp: |-
  void VoxelGridBasedEuclideanClusterNode::onPointCloud(
    const sensor_msgs::msg::PointCloud2::ConstSharedPtr input_msg)
  {
    // Start the stopwatch to measure processing time
    stop_watch_ptr_->tic("onPointCloud");

    // Convert the input PointCloud2 message to pcl::PointCloud<pcl::PointXYZ>
    pcl::PointCloud<pcl::PointXYZ>::Ptr input_cloud(new pcl::PointCloud<pcl::PointXYZ>());
    pcl::fromROSMsg(*input_msg, *input_cloud);

    // Perform clustering using the VoxelGridBasedEuclideanCluster
    autoware::perception::cluster::EuclideanClusterResult cluster_result;
    cluster_->cluster(input_cloud, cluster_result);

    // Convert the clustering results to DetectedObjectsWithFeature message
    tier4_perception_msgs::msg::DetectedObjectsWithFeature output_msg;
    cluster_->convertToDetectedObjectsWithFeature(cluster_result, output_msg);

    // Set the header information for the output message
    output_msg.header = input_msg->header;

    // Publish the clustering results
    cluster_pub_->publish(output_msg);

    // Publish debug information if enabled
    if (debug_pub_ && debug_pub_->get_subscription_count() > 0) {
      sensor_msgs::msg::PointCloud2 debug_msg;
      pcl::toROSMsg(*cluster_result.debug_cloud, debug_msg);
      debug_msg.header = input_msg->header;
      debug_pub_->publish(debug_msg);
    }

    // Publish additional debug information using the DebugPublisher
    if (debug_publisher_) {
      debug_publisher_->publishDebugInfo(cluster_result, input_msg->header);
    }

    // Stop the stopwatch and log the processing time
    stop_watch_ptr_->toc("onPointCloud");
  }
ground_truth.cpp: |-
  void VoxelGridBasedEuclideanClusterNode::onPointCloud(
    const sensor_msgs::msg::PointCloud2::ConstSharedPtr input_msg)
  {
    stop_watch_ptr_->toc("processing_time", true);

    // convert ros to pcl
    if (input_msg->data.empty()) {
      // NOTE: prevent pcl log spam
      RCLCPP_WARN_STREAM_THROTTLE(
        this->get_logger(), *this->get_clock(), 1000, "Empty sensor points!");
    }
    // cluster and build output msg
    tier4_perception_msgs::msg::DetectedObjectsWithFeature output;

    cluster_->cluster(input_msg, output);
    cluster_pub_->publish(output);

    // build debug msg
    if (debug_pub_->get_subscription_count() >= 1) {
      sensor_msgs::msg::PointCloud2 debug;
      convertObjectMsg2SensorMsg(output, debug);
      debug_pub_->publish(debug);
    }
    if (debug_publisher_) {
      const double processing_time_ms = stop_watch_ptr_->toc("processing_time", true);
      const double cyclic_time_ms = stop_watch_ptr_->toc("cyclic_time", true);
      const double pipeline_latency_ms =
        std::chrono::duration<double, std::milli>(
          std::chrono::nanoseconds((this->get_clock()->now() - output.header.stamp).nanoseconds()))
          .count();
      debug_publisher_->publish<autoware_internal_debug_msgs::msg::Float64Stamped>(
        "debug/cyclic_time_ms", cyclic_time_ms);
      debug_publisher_->publish<autoware_internal_debug_msgs::msg::Float64Stamped>(
        "debug/processing_time_ms", processing_time_ms);
      debug_publisher_->publish<autoware_internal_debug_msgs::msg::Float64Stamped>(
        "debug/pipeline_latency_ms", pipeline_latency_ms);
    }
  }
