compilation.log: |
  Starting >>> moveit_servo
  --- stderr: moveit_servo
  In file included from /usr/include/c++/11/memory:76,
                   from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/servo.h:42,
                   from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/servo_node.h:43,
                   from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/src/servo_node.cpp:40:
  /usr/include/c++/11/bits/unique_ptr.h: In instantiation of ‘typename std::_MakeUniq<_Tp>::__single_object std::make_unique(_Args&& ...) [with _Tp = moveit_servo::Servo; _Args = {std::shared_ptr<rclcpp::Node>&, std::shared_ptr<planning_scene_monitor::PlanningSceneMonitor>&, std::shared_ptr<const moveit_servo::ServoParameters>&}; typename std::_MakeUniq<_Tp>::__single_object = std::unique_ptr<moveit_servo::Servo>]’:
  /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/src/servo_node.cpp:100:49:   required from here
  /usr/include/c++/11/bits/unique_ptr.h:962:30: error: no matching function for call to ‘moveit_servo::Servo::Servo(std::shared_ptr<rclcpp::Node>&, std::shared_ptr<planning_scene_monitor::PlanningSceneMonitor>&, std::shared_ptr<const moveit_servo::ServoParameters>&)’
    962 |     { return unique_ptr<_Tp>(new _Tp(std::forward<_Args>(__args)...)); }
        |                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  In file included from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/servo_node.h:43,
                   from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/src/servo_node.cpp:40:
  /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/servo.h:57:3: note: candidate: ‘moveit_servo::Servo::Servo(const SharedPtr&, const SharedConstPtr&, const PlanningSceneMonitorPtr&)’
     57 |   Servo(const rclcpp::Node::SharedPtr& node, const ServoParameters::SharedConstPtr& parameters,
        |   ^~~~~
  /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/servo.h:57:85: note:   no known conversion for argument 2 from ‘std::shared_ptr<planning_scene_monitor::PlanningSceneMonitor>’ to ‘const SharedConstPtr&’ {aka ‘const std::shared_ptr<const moveit_servo::ServoParameters>&’}
     57 |   Servo(const rclcpp::Node::SharedPtr& node, const ServoParameters::SharedConstPtr& parameters,
        |                                              ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~
  In file included from /usr/include/x86_64-linux-gnu/c++/11/bits/c++allocator.h:33,
                   from /usr/include/c++/11/bits/allocator.h:46,
                   from /usr/include/c++/11/memory:64,
                   from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/servo.h:42,
                   from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/servo_node.h:43,
                   from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/src/servo_node.cpp:40:
  /usr/include/c++/11/ext/new_allocator.h: In instantiation of ‘void __gnu_cxx::new_allocator<_Tp>::construct(_Up*, _Args&& ...) [with _Up = const moveit_servo::ServoParameters; _Args = {}; _Tp = moveit_servo::ServoParameters]’:
  /usr/include/c++/11/bits/alloc_traits.h:516:17:   required from ‘static void std::allocator_traits<std::allocator<_Tp1> >::construct(std::allocator_traits<std::allocator<_Tp1> >::allocator_type&, _Up*, _Args&& ...) [with _Up = const moveit_servo::ServoParameters; _Args = {}; _Tp = moveit_servo::ServoParameters; std::allocator_traits<std::allocator<_Tp1> >::allocator_type = std::allocator<moveit_servo::ServoParameters>]’
  /usr/include/c++/11/bits/shared_ptr_base.h:519:39:   required from ‘std::_Sp_counted_ptr_inplace<_Tp, _Alloc, _Lp>::_Sp_counted_ptr_inplace(_Alloc, _Args&& ...) [with _Args = {}; _Tp = const moveit_servo::ServoParameters; _Alloc = std::allocator<moveit_servo::ServoParameters>; __gnu_cxx::_Lock_policy _Lp = __gnu_cxx::_S_atomic]’
  /usr/include/c++/11/bits/shared_ptr_base.h:650:16:   required from ‘std::__shared_count<_Lp>::__shared_count(_Tp*&, std::_Sp_alloc_shared_tag<_Alloc>, _Args&& ...) [with _Tp = const moveit_servo::ServoParameters; _Alloc = std::allocator<moveit_servo::ServoParameters>; _Args = {}; __gnu_cxx::_Lock_policy _Lp = __gnu_cxx::_S_atomic]’
  /usr/include/c++/11/bits/shared_ptr_base.h:1342:14:   required from ‘std::__shared_ptr<_Tp, _Lp>::__shared_ptr(std::_Sp_alloc_shared_tag<_Tp>, _Args&& ...) [with _Alloc = std::allocator<moveit_servo::ServoParameters>; _Args = {}; _Tp = const moveit_servo::ServoParameters; __gnu_cxx::_Lock_policy _Lp = __gnu_cxx::_S_atomic]’
  /usr/include/c++/11/bits/shared_ptr.h:409:59:   required from ‘std::shared_ptr<_Tp>::shared_ptr(std::_Sp_alloc_shared_tag<_Tp>, _Args&& ...) [with _Alloc = std::allocator<moveit_servo::ServoParameters>; _Args = {}; _Tp = const moveit_servo::ServoParameters]’
  /usr/include/c++/11/bits/shared_ptr.h:862:14:   required from ‘std::shared_ptr<_Tp> std::allocate_shared(const _Alloc&, _Args&& ...) [with _Tp = const moveit_servo::ServoParameters; _Alloc = std::allocator<moveit_servo::ServoParameters>; _Args = {}]’
  /usr/include/c++/11/bits/shared_ptr.h:878:39:   required from ‘std::shared_ptr<_Tp> std::make_shared(_Args&& ...) [with _Tp = const moveit_servo::ServoParameters; _Args = {}]’
  /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/src/servo_node.cpp:51:66:   required from here
  /usr/include/c++/11/ext/new_allocator.h:162:11: error: ‘moveit_servo::ServoParameters::ServoParameters()’ is private within this context
    162 |         { ::new((void *)__p) _Up(std::forward<_Args>(__args)...); }
        |           ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  In file included from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/collision_check.h:50,
                   from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/servo.h:45,
                   from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/servo_node.h:43,
                   from /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/src/servo_node.cpp:40:
  /root/repos/moveit_ws/src/moveit2/moveit_ros/moveit_servo/include/moveit_servo/servo_parameters.h:148:3: note: declared private here
    148 |   ServoParameters()
        |   ^~~~~~~~~~~~~~~
  gmake[2]: *** [CMakeFiles/servo_node.dir/build.make:76: CMakeFiles/servo_node.dir/src/servo_node.cpp.o] Error 1
  gmake[1]: *** [CMakeFiles/Makefile2:257: CMakeFiles/servo_node.dir/all] Error 2
  gmake: *** [Makefile:146: all] Error 2
  ---
  Failed   <<< moveit_servo [7.99s, exited with code 2]

  Summary: 0 packages finished [8.60s]
    1 package failed: moveit_servo
    1 package had stderr output: moveit_servo
generate_code.cpp: |-
  ServoNode::ServoNode(const rclcpp::NodeOptions& options)
    : node_{ std::make_shared<rclcpp::Node>("servo_node", options) }
  {
    // Load parameters from the ROS parameter server
    auto servo_parameters = std::make_shared<const ServoParameters>();
    node_->declare_parameter("use_gazebo", servo_parameters->use_gazebo);
    node_->declare_parameter("status_topic", servo_parameters->status_topic);
    node_->declare_parameter("cartesian_command_in_topic", servo_parameters->cartesian_command_in_topic);
    node_->declare_parameter("joint_command_in_topic", servo_parameters->joint_command_in_topic);
    node_->declare_parameter("robot_link_command_frame", servo_parameters->robot_link_command_frame);
    node_->declare_parameter("command_in_type", servo_parameters->command_in_type);
    node_->declare_parameter("linear_scale", servo_parameters->linear_scale);
    node_->declare_parameter("rotational_scale", servo_parameters->rotational_scale);
    node_->declare_parameter("joint_scale", servo_parameters->joint_scale);
    node_->declare_parameter("override_velocity_scaling_factor", servo_parameters->override_velocity_scaling_factor);
    node_->declare_parameter("command_out_topic", servo_parameters->command_out_topic);
    node_->declare_parameter("publish_period", servo_parameters->publish_period);
    node_->declare_parameter("command_out_type", servo_parameters->command_out_type);
    node_->declare_parameter("publish_joint_positions", servo_parameters->publish_joint_positions);
    node_->declare_parameter("publish_joint_velocities", servo_parameters->publish_joint_velocities);
    node_->declare_parameter("publish_joint_accelerations", servo_parameters->publish_joint_accelerations);
    node_->declare_parameter("joint_topic", servo_parameters->joint_topic);
    node_->declare_parameter("smoothing_filter_plugin_name", servo_parameters->smoothing_filter_plugin_name);
    node_->declare_parameter("move_group_name", servo_parameters->move_group_name);
    node_->declare_parameter("planning_frame", servo_parameters->planning_frame);
    node_->declare_parameter("ee_frame_name", servo_parameters->ee_frame_name);
    node_->declare_parameter("is_primary_planning_scene_monitor", servo_parameters->is_primary_planning_scene_monitor);
    node_->declare_parameter("monitored_planning_scene_topic", servo_parameters->monitored_planning_scene_topic);
    node_->declare_parameter("incoming_command_timeout", servo_parameters->incoming_command_timeout);
    node_->declare_parameter("num_outgoing_halt_msgs_to_publish", servo_parameters->num_outgoing_halt_msgs_to_publish);
    node_->declare_parameter("halt_all_joints_in_joint_mode", servo_parameters->halt_all_joints_in_joint_mode);
    node_->declare_parameter("halt_all_joints_in_cartesian_mode", servo_parameters->halt_all_joints_in_cartesian_mode);
    node_->declare_parameter("lower_singularity_threshold", servo_parameters->lower_singularity_threshold);
    node_->declare_parameter("hard_stop_singularity_threshold", servo_parameters->hard_stop_singularity_threshold);
    node_->declare_parameter("leaving_singularity_threshold_multiplier", servo_parameters->leaving_singularity_threshold_multiplier);
    node_->declare_parameter("joint_limit_margin", servo_parameters->joint_limit_margin);
    node_->declare_parameter("low_latency_mode", servo_parameters->low_latency_mode);
    node_->declare_parameter("check_collisions", servo_parameters->check_collisions);
    node_->declare_parameter("collision_check_rate", servo_parameters->collision_check_rate);
    node_->declare_parameter("self_collision_proximity_threshold", servo_parameters->self_collision_proximity_threshold);
    node_->declare_parameter("scene_collision_proximity_threshold", servo_parameters->scene_collision_proximity_threshold);

    // Initialize the PlanningSceneMonitor
    planning_scene_monitor_ = std::make_shared<planning_scene_monitor::PlanningSceneMonitor>(node_, servo_parameters->monitored_planning_scene_topic);
    planning_scene_monitor_->startStateMonitor();
    planning_scene_monitor_->startSceneMonitor();
    planning_scene_monitor_->startWorldGeometryMonitor();
    planning_scene_monitor_->setPlanningScenePublishingFrequency(servo_parameters->collision_check_rate);
    planning_scene_monitor_->startPublishingPlanningScene(planning_scene_monitor::PlanningSceneMonitor::UPDATE_SCENE);
    planning_scene_monitor_->providePlanningSceneService();
    planning_scene_monitor_->requestPlanningSceneState();

    // Initialize the Servo object
    servo_ = std::make_unique<moveit_servo::Servo>(node_, planning_scene_monitor_, servo_parameters);

    // Enable dynamics copying for the state monitor
    planning_scene_monitor_->getStateMonitor()->enableCopyDynamics(true);

    RCLCPP_INFO(node_->get_logger(), "ServoNode initialized successfully.");
  }
ground_truth.cpp: |-
  ServoNode::ServoNode(const rclcpp::NodeOptions& options)
    : node_{ std::make_shared<rclcpp::Node>("servo_node", options) }
  {
    if (!options.use_intra_process_comms())
    {
      RCLCPP_WARN_STREAM(LOGGER, "Intra-process communication is disabled, consider enabling it by adding: "
                                 "\nextra_arguments=[{'use_intra_process_comms' : True}]\nto the Servo composable node "
                                 "in the launch file");
    }

    // Set up services for interacting with Servo
    start_servo_service_ = node_->create_service<std_srvs::srv::Trigger>(
        "~/start_servo",
        [this](const std::shared_ptr<std_srvs::srv::Trigger::Request>& request,
               const std::shared_ptr<std_srvs::srv::Trigger::Response>& response) { return startCB(request, response); });
    stop_servo_service_ = node_->create_service<std_srvs::srv::Trigger>(
        "~/stop_servo",
        [this](const std::shared_ptr<std_srvs::srv::Trigger::Request>& request,
               const std::shared_ptr<std_srvs::srv::Trigger::Response>& response) { return stopCB(request, response); });
    pause_servo_service_ = node_->create_service<std_srvs::srv::Trigger>(
        "~/pause_servo",
        [this](const std::shared_ptr<std_srvs::srv::Trigger::Request>& request,
               const std::shared_ptr<std_srvs::srv::Trigger::Response>& response) { return pauseCB(request, response); });
    unpause_servo_service_ = node_->create_service<std_srvs::srv::Trigger>(
        "~/unpause_servo", [this](const std::shared_ptr<std_srvs::srv::Trigger::Request>& request,
                                  const std::shared_ptr<std_srvs::srv::Trigger::Response>& response) {
          return unpauseCB(request, response);
        });

    // Can set robot_description name from parameters
    std::string robot_description_name = "robot_description";
    node_->get_parameter_or("robot_description_name", robot_description_name, robot_description_name);

    // Get the servo parameters
    auto servo_parameters = moveit_servo::ServoParameters::makeServoParameters(node_);
    if (servo_parameters == nullptr)
    {
      RCLCPP_ERROR(LOGGER, "Failed to load the servo parameters");
      throw std::runtime_error("Failed to load the servo parameters");
    }

    // Set up planning_scene_monitor
    planning_scene_monitor_ = std::make_shared<planning_scene_monitor::PlanningSceneMonitor>(
        node_, robot_description_name, "planning_scene_monitor");
    planning_scene_monitor_->startStateMonitor(servo_parameters->joint_topic);
    planning_scene_monitor_->startSceneMonitor(servo_parameters->monitored_planning_scene_topic);
    planning_scene_monitor_->startWorldGeometryMonitor();
    planning_scene_monitor_->setPlanningScenePublishingFrequency(25);
    planning_scene_monitor_->getStateMonitor()->enableCopyDynamics(true);
    planning_scene_monitor_->startPublishingPlanningScene(planning_scene_monitor::PlanningSceneMonitor::UPDATE_SCENE,
                                                          std::string(node_->get_fully_qualified_name()) +
                                                              "/publish_planning_scene");
    // If the planning scene monitor in servo is the primary one we provide /get_planning_scene service so RViz displays
    // or secondary planning scene monitors can fetch the scene, otherwise we request the planning scene from the
    // primary planning scene monitor (e.g. move_group)
    if (servo_parameters->is_primary_planning_scene_monitor)
      planning_scene_monitor_->providePlanningSceneService();
    else
      planning_scene_monitor_->requestPlanningSceneState();

    // Create Servo
    servo_ = std::make_unique<moveit_servo::Servo>(node_, servo_parameters, planning_scene_monitor_);
  }
