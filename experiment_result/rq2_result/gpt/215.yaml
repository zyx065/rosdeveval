compilation.log: |
  Starting >>> nav2_waypoint_follower
  --- stderr: nav2_waypoint_follower
  /root/repos/nav_ws/src/nav2_waypoint_follower/plugins/photo_at_waypoint.cpp: In member function ‘virtual bool nav2_waypoint_follower::PhotoAtWaypoint::processAtWaypoint(const PoseStamped&, const int&)’:
  /root/repos/nav_ws/src/nav2_waypoint_follower/plugins/photo_at_waypoint.cpp:102:43: error: unused parameter ‘curr_pose’ [-Werror=unused-parameter]
    102 |   const geometry_msgs::msg::PoseStamped & curr_pose, const int & curr_waypoint_index)
        |   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~
  cc1plus: all warnings being treated as errors
  gmake[2]: *** [CMakeFiles/photo_at_waypoint.dir/build.make:76: CMakeFiles/photo_at_waypoint.dir/plugins/photo_at_waypoint.cpp.o] Error 1
  gmake[1]: *** [CMakeFiles/Makefile2:260: CMakeFiles/photo_at_waypoint.dir/all] Error 2
  gmake: *** [Makefile:146: all] Error 2
  ---
  Failed   <<< nav2_waypoint_follower [8.71s, exited with code 2]

  Summary: 0 packages finished [9.01s]
    1 package failed: nav2_waypoint_follower
    1 package had stderr output: nav2_waypoint_follower
generate_code.cpp: |-
  bool PhotoAtWaypoint::processAtWaypoint(
    const geometry_msgs::msg::PoseStamped & curr_pose, const int & curr_waypoint_index)
  {
    // Check if the plugin is enabled
    if (!is_enabled_) {
      RCLCPP_WARN(logger_, "PhotoAtWaypoint is disabled. Skipping photo capture.");
      return false;
    }

    // Lock the global mutex to safely access the current frame
    std::lock_guard<std::mutex> lock(global_mutex_);

    // Check if the current frame is available
    if (!curr_frame_msg_) {
      RCLCPP_ERROR(logger_, "No current frame available to capture photo.");
      return false;
    }

    // Convert the ROS Image message to an OpenCV Mat
    cv::Mat image;
    try {
      deepCopyMsg2Mat(curr_frame_msg_, image);
    } catch (const std::exception &e) {
      RCLCPP_ERROR(logger_, "Failed to convert ROS Image message to OpenCV Mat: %s", e.what());
      return false;
    }

    // Generate the filename using waypoint index and timestamp
    auto now = std::chrono::system_clock::now();
    auto now_time_t = std::chrono::system_clock::to_time_t(now);
    std::stringstream filename;
    filename << "waypoint_" << curr_waypoint_index << "_"
             << std::put_time(std::localtime(&now_time_t), "%Y%m%d_%H%M%S") << "." << image_format_;

    // Construct the full path to save the image
    std::filesystem::path file_path = save_dir_ / filename.str();

    // Save the image to the file
    try {
      if (!cv::imwrite(file_path.string(), image)) {
        RCLCPP_ERROR(logger_, "Failed to save image to file: %s", file_path.string().c_str());
        return false;
      }
    } catch (const cv::Exception &e) {
      RCLCPP_ERROR(logger_, "OpenCV exception while saving image: %s", e.what());
      return false;
    }

    // Log success
    RCLCPP_INFO(logger_, "Photo successfully captured and saved to: %s", file_path.string().c_str());
    return true;
  }
ground_truth.cpp: |-
  bool PhotoAtWaypoint::processAtWaypoint(
    const geometry_msgs::msg::PoseStamped & curr_pose, const int & curr_waypoint_index)
  {
    if (!is_enabled_) {
      RCLCPP_WARN(
        logger_,
        "Photo at waypoint plugin is disabled. Not performing anything"
      );
      return true;
    }
    try {
      // construct the full path to image filename
      std::filesystem::path file_name = std::to_string(
        curr_waypoint_index) + "_" +
        std::to_string(curr_pose.header.stamp.sec) + "." + image_format_;
      std::filesystem::path full_path_image_path = save_dir_ / file_name;

      // save the taken photo at this waypoint to given directory
      std::lock_guard<std::mutex> guard(global_mutex_);
      cv::Mat curr_frame_mat;
      deepCopyMsg2Mat(curr_frame_msg_, curr_frame_mat);
      cv::imwrite(full_path_image_path.c_str(), curr_frame_mat);
      RCLCPP_INFO(
        logger_,
        "Photo has been taken sucessfully at waypoint %i", curr_waypoint_index);
    } catch (const std::exception & e) {
      RCLCPP_ERROR(
        logger_,
        "Couldn't take photo at waypoint %i! Caught exception: %s \n"
        "Make sure that the image topic named: %s is valid and active!",
        curr_waypoint_index,
        e.what(), image_topic_.c_str());
      return false;
    }
    return true;
  }
