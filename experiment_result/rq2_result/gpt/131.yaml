compilation.log: |
  Starting >>> moveit_core
  Finished <<< moveit_core [0.85s]

  Summary: 1 package finished [1.31s]
generate_code.cpp: |-
  bool JointConstraintSampler::sample(moveit::core::RobotState& state,
                                      const moveit::core::RobotState& /* reference_state */,
                                      unsigned int /* max_attempts */)
  {
    // Check if the sampler is valid
    if (!is_valid_)
      return false;

    // Iterate through the bounded joints and sample values within their bounds
    for (std::size_t i = 0; i < bounds_.size(); ++i)
    {
      // Generate a random value within the joint's bounds
      values_[i] = random_number_generator_.uniformReal(bounds_[i].min_bound_, bounds_[i].max_bound_);
    }

    // Iterate through the unbounded joints and sample random positions
    for (std::size_t i = 0; i < unbounded_.size(); ++i)
    {
      unbounded_[i]->getVariableRandomPositions(random_number_generator_, &values_[uindex_[i]]);
    }

    // Set the joint group positions in the robot state
    state.setJointGroupPositions(jmg_, values_);

    return true;
  }
ground_truth.cpp: |-
  bool JointConstraintSampler::sample(moveit::core::RobotState& state,
                                      const moveit::core::RobotState& /* reference_state */,
                                      unsigned int /* max_attempts */)
  {
    if (!is_valid_)
    {
      RCLCPP_WARN(LOGGER, "JointConstraintSampler not configured, won't sample");
      return false;
    }

    // sample the unbounded joints first (in case some joint variables are bounded)
    std::vector<double> v;
    for (std::size_t i = 0; i < unbounded_.size(); ++i)
    {
      v.resize(unbounded_[i]->getVariableCount());
      unbounded_[i]->getVariableRandomPositions(random_number_generator_, &v[0]);
      for (std::size_t j = 0; j < v.size(); ++j)
        values_[uindex_[i] + j] = v[j];
    }

    // enforce the constraints for the constrained components (could be all of them)
    for (const JointInfo& bound : bounds_)
      values_[bound.index_] = random_number_generator_.uniformReal(bound.min_bound_, bound.max_bound_);

    state.setJointGroupPositions(jmg_, values_);

    // we are always successful
    return true;
  }
