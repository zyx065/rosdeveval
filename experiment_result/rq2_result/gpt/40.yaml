compilation.log: |
  Starting >>> autoware_traffic_light_arbiter
  Finished <<< autoware_traffic_light_arbiter [18.1s]

  Summary: 1 package finished [19.6s]
generate_code.cpp: |-
  TrafficLightArbiter::TrafficLightArbiter(const rclcpp::NodeOptions & options)
  : Node("traffic_light_arbiter", options),
    external_time_tolerance_(declare_parameter("external_time_tolerance", 0.5)),
    perception_time_tolerance_(declare_parameter("perception_time_tolerance", 0.5)),
    external_priority_(declare_parameter("external_priority", false)),
    enable_signal_matching_(declare_parameter("enable_signal_matching", true))
  {
    // Initialize subscriptions
    map_sub_ = this->create_subscription<LaneletMapBin>(
      "input/map", rclcpp::QoS(1),
      std::bind(&TrafficLightArbiter::onMap, this, std::placeholders::_1));

    perception_tlr_sub_ = this->create_subscription<TrafficSignalArray>(
      "input/perception_traffic_signals", rclcpp::QoS(1),
      std::bind(&TrafficLightArbiter::onPerceptionMsg, this, std::placeholders::_1));

    external_tlr_sub_ = this->create_subscription<TrafficSignalArray>(
      "input/external_traffic_signals", rclcpp::QoS(1),
      std::bind(&TrafficLightArbiter::onExternalMsg, this, std::placeholders::_1));

    // Initialize publisher
    pub_ = this->create_publisher<TrafficSignalArray>("output/traffic_signals", rclcpp::QoS(1));

    // Configure SignalMatchValidator
    SignalMatchValidator signal_match_validator;
    signal_match_validator.setExternalPriority(external_priority_);
  }
ground_truth.cpp: |-
  TrafficLightArbiter::TrafficLightArbiter(const rclcpp::NodeOptions & options)
  : Node("traffic_light_arbiter", options)
  {
    external_delay_tolerance_ = this->declare_parameter<double>("external_delay_tolerance", 5.0);
    external_time_tolerance_ = this->declare_parameter<double>("external_time_tolerance", 5.0);
    perception_time_tolerance_ = this->declare_parameter<double>("perception_time_tolerance", 1.0);
    external_priority_ = this->declare_parameter<bool>("external_priority", false);
    enable_signal_matching_ = this->declare_parameter<bool>("enable_signal_matching", false);

    if (enable_signal_matching_) {
      signal_match_validator_ = std::make_unique<SignalMatchValidator>();
      signal_match_validator_->setExternalPriority(external_priority_);
    }

    map_sub_ = create_subscription<LaneletMapBin>(
      "~/sub/vector_map", rclcpp::QoS(1).transient_local(),
      std::bind(&TrafficLightArbiter::onMap, this, std::placeholders::_1));

    perception_tlr_sub_ = create_subscription<TrafficSignalArray>(
      "~/sub/perception_traffic_signals", rclcpp::QoS(1),
      std::bind(&TrafficLightArbiter::onPerceptionMsg, this, std::placeholders::_1));

    external_tlr_sub_ = create_subscription<TrafficSignalArray>(
      "~/sub/external_traffic_signals", rclcpp::QoS(1),
      std::bind(&TrafficLightArbiter::onExternalMsg, this, std::placeholders::_1));

    pub_ = create_publisher<TrafficSignalArray>("~/pub/traffic_signals", rclcpp::QoS(1));
  }
