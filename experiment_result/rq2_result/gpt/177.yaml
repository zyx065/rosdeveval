compilation.log: "Starting >>> nav2_velocity_smoother\n--- stderr: nav2_velocity_smoother\n\
  /root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp: In member\
  \ function ‘virtual nav2_util::CallbackReturn nav2_velocity_smoother::VelocitySmoother::on_configure(const\
  \ rclcpp_lifecycle::State&)’:\n/root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:83:35:\
  \ error: no matching function for call to ‘nav2_util::LifecycleNode::create_wall_timer(rclcpp::Duration&,\
  \ nav2_velocity_smoother::VelocitySmoother::on_configure(const rclcpp_lifecycle::State&)::<lambda()>)’\n\
  \   83 |   timer_ = node->create_wall_timer(\n      |            ~~~~~~~~~~~~~~~~~~~~~~~^\n\
  \   84 |     timer_period,\n      |     ~~~~~~~~~~~~~                  \n   85 |\
  \     [this]() {\n      |     ~~~~~~~~~~                     \n   86 |       if\
  \ (!stopped_) {\n      |       ~~~~~~~~~~~~~~~~             \n   87 |         //\
  \ Publish smoothed command\n      |         ~~~~~~~~~~~~~~~~~~~~~~~~~~~\n   88 |\
  \         smoothed_cmd_pub_->publish(last_cmd_);\n      |         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\
  \   89 |       }\n      |       ~                            \n   90 |     });\n\
  \      |     ~~                             \nIn file included from /root/repos/nav_ws/install/nav2_util/include/nav2_util/lifecycle_node.hpp:23,\n\
  \                 from /root/repos/nav_ws/src/nav2_velocity_smoother/include/nav2_velocity_smoother/velocity_smoother.hpp:25,\n\
  \                 from /root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:22:\n\
  /opt/ros/humble/include/rclcpp_lifecycle/rclcpp_lifecycle/lifecycle_node.hpp:253:3:\
  \ note: candidate: ‘template<class DurationRepT, class DurationT, class CallbackT>\
  \ typename rclcpp::WallTimer<CallbackT>::SharedPtr rclcpp_lifecycle::LifecycleNode::create_wall_timer(std::chrono::duration<_Rep1,\
  \ _Period1>, CallbackT, rclcpp::CallbackGroup::SharedPtr)’\n  253 |   create_wall_timer(\n\
  \      |   ^~~~~~~~~~~~~~~~~\n/opt/ros/humble/include/rclcpp_lifecycle/rclcpp_lifecycle/lifecycle_node.hpp:253:3:\
  \ note:   template argument deduction/substitution failed:\n/root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:83:35:\
  \ note:   ‘rclcpp::Duration’ is not derived from ‘std::chrono::duration<_Rep1, _Period1>’\n\
  \   83 |   timer_ = node->create_wall_timer(\n      |            ~~~~~~~~~~~~~~~~~~~~~~~^\n\
  \   84 |     timer_period,\n      |     ~~~~~~~~~~~~~                  \n   85 |\
  \     [this]() {\n      |     ~~~~~~~~~~                     \n   86 |       if\
  \ (!stopped_) {\n      |       ~~~~~~~~~~~~~~~~             \n   87 |         //\
  \ Publish smoothed command\n      |         ~~~~~~~~~~~~~~~~~~~~~~~~~~~\n   88 |\
  \         smoothed_cmd_pub_->publish(last_cmd_);\n      |         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n\
  \   89 |       }\n      |       ~                            \n   90 |     });\n\
  \      |     ~~                             \n/root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:47:64:\
  \ error: unused parameter ‘state’ [-Werror=unused-parameter]\n   47 | VelocitySmoother::on_configure(const\
  \ rclcpp_lifecycle::State & state)\n      |                                ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~\n\
  In file included from /usr/include/c++/11/memory:76,\n                 from /root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:17:\n\
  /usr/include/c++/11/bits/unique_ptr.h: In instantiation of ‘typename std::_MakeUniq<_Tp>::__single_object\
  \ std::make_unique(_Args&& ...) [with _Tp = nav2_util::OdomSmoother; _Args = {std::shared_ptr<nav2_util::LifecycleNode>&,\
  \ std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char>\
  \ >&, double&}; typename std::_MakeUniq<_Tp>::__single_object = std::unique_ptr<nav2_util::OdomSmoother>]’:\n\
  /root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:94:63: \
  \  required from here\n/usr/include/c++/11/bits/unique_ptr.h:962:30: error: no matching\
  \ function for call to ‘nav2_util::OdomSmoother::OdomSmoother(std::shared_ptr<nav2_util::LifecycleNode>&,\
  \ std::__cxx11::basic_string<char>&, double&)’\n  962 |     { return unique_ptr<_Tp>(new\
  \ _Tp(std::forward<_Args>(__args)...)); }\n      |                             \
  \ ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nIn file included from /root/repos/nav_ws/src/nav2_velocity_smoother/include/nav2_velocity_smoother/velocity_smoother.hpp:27,\n\
  \                 from /root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:22:\n\
  /root/repos/nav_ws/install/nav2_util/include/nav2_util/odometry_utils.hpp:62:12:\
  \ note: candidate: ‘nav2_util::OdomSmoother::OdomSmoother(const WeakPtr&, double,\
  \ const string&)’\n   62 |   explicit OdomSmoother(\n      |            ^~~~~~~~~~~~\n\
  /root/repos/nav_ws/install/nav2_util/include/nav2_util/odometry_utils.hpp:64:12:\
  \ note:   no known conversion for argument 2 from ‘std::__cxx11::basic_string<char>’\
  \ to ‘double’\n   64 |     double filter_duration = 0.3,\n      |     ~~~~~~~^~~~~~~~~~~~~~~~~~~~~\n\
  /root/repos/nav_ws/install/nav2_util/include/nav2_util/odometry_utils.hpp:50:12:\
  \ note: candidate: ‘nav2_util::OdomSmoother::OdomSmoother(const WeakPtr&, double,\
  \ const string&)’\n   50 |   explicit OdomSmoother(\n      |            ^~~~~~~~~~~~\n\
  /root/repos/nav_ws/install/nav2_util/include/nav2_util/odometry_utils.hpp:51:35:\
  \ note:   no known conversion for argument 1 from ‘std::shared_ptr<nav2_util::LifecycleNode>’\
  \ to ‘const WeakPtr&’ {aka ‘const std::weak_ptr<rclcpp::Node>&’}\n   51 |     const\
  \ rclcpp::Node::WeakPtr & parent,\n      |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~\n\
  cc1plus: all warnings being treated as errors\ngmake[2]: *** [CMakeFiles/velocity_smoother_core.dir/build.make:76:\
  \ CMakeFiles/velocity_smoother_core.dir/src/velocity_smoother.cpp.o] Error 1\ngmake[1]:\
  \ *** [CMakeFiles/Makefile2:174: CMakeFiles/velocity_smoother_core.dir/all] Error\
  \ 2\ngmake: *** [Makefile:146: all] Error 2\n---\nFailed   <<< nav2_velocity_smoother\
  \ [4.05s, exited with code 2]\n\nSummary: 0 packages finished [4.36s]\n  1 package\
  \ failed: nav2_velocity_smoother\n  1 package had stderr output: nav2_velocity_smoother\n"
generate_code.cpp: |-
  nav2_util::CallbackReturn
  VelocitySmoother::on_configure(const rclcpp_lifecycle::State & state)
  {
    // Declare and get parameters
    auto node = shared_from_this();
    node->declare_parameter("smoothing_frequency", 20.0);
    node->declare_parameter("odom_duration", 0.1);
    node->declare_parameter("odom_topic", "odom");
    node->declare_parameter("open_loop", false);
    node->declare_parameter("scale_velocities", true);
    node->declare_parameter("max_velocities", std::vector<double>{0.5, 0.5, 0.5});
    node->declare_parameter("min_velocities", std::vector<double>{-0.5, -0.5, -0.5});
    node->declare_parameter("max_accels", std::vector<double>{0.2, 0.2, 0.2});
    node->declare_parameter("max_decels", std::vector<double>{0.2, 0.2, 0.2});
    node->declare_parameter("deadband_velocities", std::vector<double>{0.01, 0.01, 0.01});
    node->declare_parameter("velocity_timeout", 0.5);

    smoothing_frequency_ = node->get_parameter("smoothing_frequency").as_double();
    odom_duration_ = node->get_parameter("odom_duration").as_double();
    odom_topic_ = node->get_parameter("odom_topic").as_string();
    open_loop_ = node->get_parameter("open_loop").as_bool();
    scale_velocities_ = node->get_parameter("scale_velocities").as_bool();
    max_velocities_ = node->get_parameter("max_velocities").as_double_array();
    min_velocities_ = node->get_parameter("min_velocities").as_double_array();
    max_accels_ = node->get_parameter("max_accels").as_double_array();
    max_decels_ = node->get_parameter("max_decels").as_double_array();
    deadband_velocities_ = node->get_parameter("deadband_velocities").as_double_array();
    velocity_timeout_ = rclcpp::Duration::from_seconds(node->get_parameter("velocity_timeout").as_double());

    // Initialize publishers and subscribers
    smoothed_cmd_pub_ = node->create_publisher<geometry_msgs::msg::Twist>("smoothed_cmd_vel", rclcpp::QoS(10));
    cmd_sub_ = node->create_subscription<geometry_msgs::msg::Twist>(
      "cmd_vel", rclcpp::QoS(10),
      std::bind(&VelocitySmoother::inputCommandCallback, this, std::placeholders::_1));

    // Initialize timer for smoothing
    auto timer_period = rclcpp::Duration::from_seconds(1.0 / smoothing_frequency_);
    timer_ = node->create_wall_timer(
      timer_period,
      [this]() {
        if (!stopped_) {
          // Publish smoothed command
          smoothed_cmd_pub_->publish(last_cmd_);
        }
      });

    // Initialize odom smoother if in closed-loop mode
    if (!open_loop_) {
      odom_smoother_ = std::make_unique<nav2_util::OdomSmoother>(node, odom_topic_, odom_duration_);
    }

    // Initialize clock
    clock_ = node->get_clock();

    // Reset state variables
    last_command_time_ = clock_->now();
    last_cmd_ = geometry_msgs::msg::Twist();
    command_ = nullptr;

    RCLCPP_INFO(node->get_logger(), "VelocitySmoother configured successfully.");
    return nav2_util::CallbackReturn::SUCCESS;
  }
ground_truth.cpp: |-
  nav2_util::CallbackReturn
  VelocitySmoother::on_configure(const rclcpp_lifecycle::State &)
  {
    RCLCPP_INFO(get_logger(), "Configuring velocity smoother");
    auto node = shared_from_this();
    std::string feedback_type;
    double velocity_timeout_dbl;

    // Smoothing metadata
    declare_parameter_if_not_declared(node, "smoothing_frequency", rclcpp::ParameterValue(20.0));
    declare_parameter_if_not_declared(
      node, "feedback", rclcpp::ParameterValue(std::string("OPEN_LOOP")));
    declare_parameter_if_not_declared(node, "scale_velocities", rclcpp::ParameterValue(false));
    node->get_parameter("smoothing_frequency", smoothing_frequency_);
    node->get_parameter("feedback", feedback_type);
    node->get_parameter("scale_velocities", scale_velocities_);

    // Kinematics
    declare_parameter_if_not_declared(
      node, "max_velocity", rclcpp::ParameterValue(std::vector<double>{0.50, 0.0, 2.5}));
    declare_parameter_if_not_declared(
      node, "min_velocity", rclcpp::ParameterValue(std::vector<double>{-0.50, 0.0, -2.5}));
    declare_parameter_if_not_declared(
      node, "max_accel", rclcpp::ParameterValue(std::vector<double>{2.5, 0.0, 3.2}));
    declare_parameter_if_not_declared(
      node, "max_decel", rclcpp::ParameterValue(std::vector<double>{-2.5, 0.0, -3.2}));
    node->get_parameter("max_velocity", max_velocities_);
    node->get_parameter("min_velocity", min_velocities_);
    node->get_parameter("max_accel", max_accels_);
    node->get_parameter("max_decel", max_decels_);

    for (unsigned int i = 0; i != 3; i++) {
      if (max_decels_[i] > 0.0) {
        throw std::runtime_error(
                "Positive values set of deceleration! These should be negative to slow down!");
      }
      if (max_accels_[i] < 0.0) {
        throw std::runtime_error(
                "Negative values set of acceleration! These should be positive to speed up!");
      }
      if (min_velocities_[i] > max_velocities_[i]) {
        throw std::runtime_error(
                "Min velocities are higher than max velocities!");
      }
    }

    // Get feature parameters
    declare_parameter_if_not_declared(node, "odom_topic", rclcpp::ParameterValue("odom"));
    declare_parameter_if_not_declared(node, "odom_duration", rclcpp::ParameterValue(0.1));
    declare_parameter_if_not_declared(
      node, "deadband_velocity", rclcpp::ParameterValue(std::vector<double>{0.0, 0.0, 0.0}));
    declare_parameter_if_not_declared(node, "velocity_timeout", rclcpp::ParameterValue(1.0));
    node->get_parameter("odom_topic", odom_topic_);
    node->get_parameter("odom_duration", odom_duration_);
    node->get_parameter("deadband_velocity", deadband_velocities_);
    node->get_parameter("velocity_timeout", velocity_timeout_dbl);
    velocity_timeout_ = rclcpp::Duration::from_seconds(velocity_timeout_dbl);

    if (max_velocities_.size() != 3 || min_velocities_.size() != 3 ||
      max_accels_.size() != 3 || max_decels_.size() != 3 || deadband_velocities_.size() != 3)
    {
      throw std::runtime_error(
              "Invalid setting of kinematic and/or deadband limits!"
              " All limits must be size of 3 representing (x, y, theta).");
    }

    // Get control type
    if (feedback_type == "OPEN_LOOP") {
      open_loop_ = true;
    } else if (feedback_type == "CLOSED_LOOP") {
      open_loop_ = false;
      odom_smoother_ = std::make_unique<nav2_util::OdomSmoother>(node, odom_duration_, odom_topic_);
    } else {
      throw std::runtime_error("Invalid feedback_type, options are OPEN_LOOP and CLOSED_LOOP.");
    }

    // Setup inputs / outputs
    smoothed_cmd_pub_ = create_publisher<geometry_msgs::msg::Twist>("cmd_vel_smoothed", 1);
    cmd_sub_ = create_subscription<geometry_msgs::msg::Twist>(
      "cmd_vel", rclcpp::QoS(1),
      std::bind(&VelocitySmoother::inputCommandCallback, this, std::placeholders::_1));

    return nav2_util::CallbackReturn::SUCCESS;
  }
