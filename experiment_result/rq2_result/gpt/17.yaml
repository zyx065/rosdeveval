compilation.log: |
  Starting >>> autoware_perception_online_evaluator
  --- stderr: autoware_perception_online_evaluator
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp: In member function ‘void autoware::perception_diagnostics::PerceptionOnlineEvaluatorNode::publishMetrics()’:
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:70:15: error: ‘using MetricArray = struct tier4_metric_msgs::msg::MetricArray_<std::allocator<void> >’ {aka ‘struct tier4_metric_msgs::msg::MetricArray_<std::allocator<void> >’} has no member named ‘header’
     70 |   metrics_msg.header.stamp = this->now();  // Use the current node time
        |               ^~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:71:15: error: ‘using MetricArray = struct tier4_metric_msgs::msg::MetricArray_<std::allocator<void> >’ {aka ‘struct tier4_metric_msgs::msg::MetricArray_<std::allocator<void> >’} has no member named ‘header’
     71 |   metrics_msg.header.frame_id = "map";     // Set the frame ID (can be adjusted as needed)
        |               ^~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:78:16: error: request for member ‘type’ in ‘metric’, which is of non-class type ‘const autoware::perception_diagnostics::Metric’
     78 |     if (metric.type == MetricType::TRAJECTORY) {
        |                ^~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:78:24: error: ‘MetricType’ has not been declared
     78 |     if (metric.type == MetricType::TRAJECTORY) {
        |                        ^~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:79:81: error: ‘class autoware::perception_diagnostics::MetricsCalculator’ has no member named ‘getLookaheadTrajectory’
     79 |       metric_result = metrics_calculator_.calculate(metric, metrics_calculator_.getLookaheadTrajectory(
        |                                                                                 ^~~~~~~~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:80:29: error: ‘class autoware::perception_diagnostics::MetricsCalculator’ has no member named ‘reference_trajectory_’
     80 |         metrics_calculator_.reference_trajectory_,
        |                             ^~~~~~~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:81:22: error: ‘using element_type = struct autoware::perception_diagnostics::Parameters’ {aka ‘struct autoware::perception_diagnostics::Parameters’} has no member named ‘max_lookahead_distance’
     81 |         parameters_->max_lookahead_distance,
        |                      ^~~~~~~~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:82:22: error: ‘using element_type = struct autoware::perception_diagnostics::Parameters’ {aka ‘struct autoware::perception_diagnostics::Parameters’} has no member named ‘max_lookahead_time’
     82 |         parameters_->max_lookahead_time));
        |                      ^~~~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:83:23: error: request for member ‘type’ in ‘metric’, which is of non-class type ‘const autoware::perception_diagnostics::Metric’
     83 |     } else if (metric.type == MetricType::POSE) {
        |                       ^~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:83:31: error: ‘MetricType’ has not been declared
     83 |     } else if (metric.type == MetricType::POSE) {
        |                               ^~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:84:81: error: ‘class autoware::perception_diagnostics::MetricsCalculator’ has no member named ‘getEgoPose’
     84 |       metric_result = metrics_calculator_.calculate(metric, metrics_calculator_.getEgoPose(), metric.target_pose);
        |                                                                                 ^~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:84:102: error: request for member ‘target_pose’ in ‘metric’, which is of non-class type ‘const autoware::perception_diagnostics::Metric’
     84 |       metric_result = metrics_calculator_.calculate(metric, metrics_calculator_.getEgoPose(), metric.target_pose);
        |                                                                                                      ^~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:89:26: error: request for member ‘name’ in ‘metric’, which is of non-class type ‘const autoware::perception_diagnostics::Metric’
     89 |       toMetricMsg(metric.name, metric_result.value(), metrics_msg);
        |                          ^~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:94:20: error: ‘using MetricArray = struct tier4_metric_msgs::msg::MetricArray_<std::allocator<void> >’ {aka ‘struct tier4_metric_msgs::msg::MetricArray_<std::allocator<void> >’} has no member named ‘metrics’
     94 |   if (!metrics_msg.metrics.empty()) {
        |                    ^~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:95:5: error: ‘metrics_publisher_’ was not declared in this scope; did you mean ‘metrics_pub_’?
     95 |     metrics_publisher_->publish(metrics_msg);
        |     ^~~~~~~~~~~~~~~~~~
        |     metrics_pub_
  /workspace/repos/autoware/src/universe/autoware.universe/evaluator/autoware_perception_online_evaluator/src/perception_online_evaluator_node.cpp:104:3: error: ‘debug_marker_publisher_’ was not declared in this scope
    104 |   debug_marker_publisher_->publish(marker_array);
        |   ^~~~~~~~~~~~~~~~~~~~~~~
  gmake[2]: *** [CMakeFiles/autoware_perception_online_evaluator.dir/build.make:90: CMakeFiles/autoware_perception_online_evaluator.dir/src/perception_online_evaluator_node.cpp.o] Error 1
  gmake[1]: *** [CMakeFiles/Makefile2:159: CMakeFiles/autoware_perception_online_evaluator.dir/all] Error 2
  gmake: *** [Makefile:146: all] Error 2
  ---
  Failed   <<< autoware_perception_online_evaluator [7.07s, exited with code 2]

  Summary: 0 packages finished [8.51s]
    1 package failed: autoware_perception_online_evaluator
    1 package had stderr output: autoware_perception_online_evaluator
generate_code.cpp: |-
  void PerceptionOnlineEvaluatorNode::publishMetrics()
  {
    // Create a MetricArray message to hold the metrics
    tier4_metric_msgs::msg::MetricArray metrics_msg;
    metrics_msg.header.stamp = this->now();  // Use the current node time
    metrics_msg.header.frame_id = "map";     // Set the frame ID (can be adjusted as needed)

    // Iterate through the configured metrics in parameters_
    for (const auto & metric : parameters_->metrics) {
      std::optional<Accumulator<double>> metric_result;

      // Calculate the metric based on the type
      if (metric.type == MetricType::TRAJECTORY) {
        metric_result = metrics_calculator_.calculate(metric, metrics_calculator_.getLookaheadTrajectory(
          metrics_calculator_.reference_trajectory_,
          parameters_->max_lookahead_distance,
          parameters_->max_lookahead_time));
      } else if (metric.type == MetricType::POSE) {
        metric_result = metrics_calculator_.calculate(metric, metrics_calculator_.getEgoPose(), metric.target_pose);
      }

      // If the metric calculation is valid, convert it to a Metric message and add it to the array
      if (metric_result.has_value()) {
        toMetricMsg(metric.name, metric_result.value(), metrics_msg);
      }
    }

    // Publish the metrics if there are any valid results
    if (!metrics_msg.metrics.empty()) {
      metrics_publisher_->publish(metrics_msg);
    }

    // Publish debug markers for visualization
    visualization_msgs::msg::MarkerArray marker_array;
    // Populate marker_array with debug markers (implementation depends on specific debug needs)
    // Example: Add markers for trajectories, poses, or other relevant data
    // marker_array.markers.push_back(...);

    debug_marker_publisher_->publish(marker_array);
  }
ground_truth.cpp: |-
  void PerceptionOnlineEvaluatorNode::publishMetrics()
  {
    // DiagnosticArray metrics_msg;
    tier4_metric_msgs::msg::MetricArray metrics_msg;

    // calculate metrics
    for (const Metric & metric : parameters_->metrics) {
      const auto metric_result = metrics_calculator_.calculate(Metric(metric));
      if (!metric_result.has_value()) {
        continue;
      }

      std::visit(
        [&metrics_msg, this](auto && arg) {
          using T = std::decay_t<decltype(arg)>;
          for (const auto & [metric, value] : arg) {
            if constexpr (std::is_same_v<T, MetricStatMap>) {
              if (value.count() > 0) {
                toMetricMsg(metric, value, metrics_msg);
              }
            } else if constexpr (std::is_same_v<T, MetricValueMap>) {
              toMetricMsg(metric, value, metrics_msg);
            }
          }
        },
        metric_result.value());
    }

    // publish metrics
    if (!metrics_msg.metric_array.empty()) {
      metrics_msg.stamp = now();
      metrics_pub_->publish(metrics_msg);
    }
    publishDebugMarker();
  }
