compilation.log: |
  Starting >>> autoware_detected_object_validation
  --- stderr: autoware_detected_object_validation
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.cpp: In member function ‘void autoware::detected_object_validation::lanelet_filter::ObjectLaneletFilterNode::objectCallback(autoware_perception_msgs::msg::DetectedObjects_<std::allocator<void> >::ConstSharedPtr)’:
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.cpp:138:20: error: ‘class autoware::universe_utils::StopWatch<std::chrono::duration<long int, std::ratio<1, 1000> > >’ has no member named ‘start’; did you mean ‘std::unordered_map<std::__cxx11::basic_string<char>, std::chrono::time_point<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> > >, std::hash<std::__cxx11::basic_string<char> >, std::equal_to<std::__cxx11::basic_string<char> >, std::allocator<std::pair<const std::__cxx11::basic_string<char>, std::chrono::time_point<std::chrono::_V2::steady_clock, std::chrono::duration<long int, std::ratio<1, 1000000000> > > > > > autoware::universe_utils::StopWatch<std::chrono::duration<long int, std::ratio<1, 1000> > >::t_start_’? (not accessible from this context)
    138 |   stop_watch_ptr_->start("objectCallback");
        |                    ^~~~~
  In file included from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.hpp:22,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.cpp:15:
  /workspace/repos/autoware/install/autoware_universe_utils/include/autoware/universe_utils/system/stop_watch.hpp:59:41: note: declared private here
     59 |   std::unordered_map<std::string, Time> t_start_;
        |                                         ^~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.cpp:150:26: error: no match for ‘operator*’ (operand type is ‘tf2_ros::Buffer’)
    150 |       *input_msg, "map", *tf_buffer_, transformed_objects);
        |                          ^~~~~~~~~~~
  In file included from /opt/ros/humble/include/tf2/tf2/LinearMath/Quaternion.h:21,
                   from /opt/ros/humble/include/tf2_geometry_msgs/tf2_geometry_msgs/tf2_geometry_msgs.hpp:57,
                   from /workspace/repos/autoware/install/autoware_universe_utils/include/autoware/universe_utils/geometry/geometry.hpp:40,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.hpp:19,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.cpp:15:
  /opt/ros/humble/include/tf2/tf2/LinearMath/Vector3.h:364:1: note: candidate: ‘tf2::Vector3 tf2::operator*(const tf2::Vector3&, const tf2::Vector3&)’
    364 | operator*(const Vector3& v1, const Vector3& v2)
        | ^~~~~~~~
  /opt/ros/humble/include/tf2/tf2/LinearMath/Vector3.h:364:1: note:   candidate expects 2 arguments, 1 provided
  /opt/ros/humble/include/tf2/tf2/LinearMath/Vector3.h:384:1: note: candidate: ‘tf2::Vector3 tf2::operator*(const tf2::Vector3&, const tf2Scalar&)’
    384 | operator*(const Vector3& v, const tf2Scalar& s)
        | ^~~~~~~~
  /opt/ros/humble/include/tf2/tf2/LinearMath/Vector3.h:384:1: note:   candidate expects 2 arguments, 1 provided
  /opt/ros/humble/include/tf2/tf2/LinearMath/Vector3.h:391:1: note: candidate: ‘tf2::Vector3 tf2::operator*(const tf2Scalar&, const tf2::Vector3&)’
    391 | operator*(const tf2Scalar& s, const Vector3& v)
        | ^~~~~~~~
  /opt/ros/humble/include/tf2/tf2/LinearMath/Vector3.h:391:1: note:   candidate expects 2 arguments, 1 provided
  In file included from /opt/ros/humble/include/tf2_geometry_msgs/tf2_geometry_msgs/tf2_geometry_msgs.hpp:57,
                   from /workspace/repos/autoware/install/autoware_universe_utils/include/autoware/universe_utils/geometry/geometry.hpp:40,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.hpp:19,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.cpp:15:
  /opt/ros/humble/include/tf2/tf2/LinearMath/Quaternion.h:368:1: note: candidate: ‘tf2::Quaternion tf2::operator*(const tf2::Quaternion&, const tf2::Quaternion&)’
    368 | operator*(const Quaternion& q1, const Quaternion& q2) {
        | ^~~~~~~~
  /opt/ros/humble/include/tf2/tf2/LinearMath/Quaternion.h:368:1: note:   candidate expects 2 arguments, 1 provided
  /opt/ros/humble/include/tf2/tf2/LinearMath/Quaternion.h:376:1: note: candidate: ‘tf2::Quaternion tf2::operator*(const tf2::Quaternion&, const tf2::Vector3&)’
    376 | operator*(const Quaternion& q, const Vector3& w)
        | ^~~~~~~~
  /opt/ros/humble/include/tf2/tf2/LinearMath/Quaternion.h:376:1: note:   candidate expects 2 arguments, 1 provided
  /opt/ros/humble/include/tf2/tf2/LinearMath/Quaternion.h:385:1: note: candidate: ‘tf2::Quaternion tf2::operator*(const tf2::Vector3&, const tf2::Quaternion&)’
    385 | operator*(const Vector3& w, const Quaternion& q)
        | ^~~~~~~~
  /opt/ros/humble/include/tf2/tf2/LinearMath/Quaternion.h:385:1: note:   candidate expects 2 arguments, 1 provided
  In file included from /opt/ros/humble/include/tf2/tf2/LinearMath/Transform.h:21,
                   from /opt/ros/humble/include/tf2_geometry_msgs/tf2_geometry_msgs/tf2_geometry_msgs.hpp:58,
                   from /workspace/repos/autoware/install/autoware_universe_utils/include/autoware/universe_utils/geometry/geometry.hpp:40,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.hpp:19,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.cpp:15:
  /opt/ros/humble/include/tf2/tf2/LinearMath/Matrix3x3.h:611:1: note: candidate: ‘tf2::Vector3 tf2::operator*(const tf2::Matrix3x3&, const tf2::Vector3&)’
    611 | operator*(const Matrix3x3& m, const Vector3& v)
        | ^~~~~~~~
  /opt/ros/humble/include/tf2/tf2/LinearMath/Matrix3x3.h:611:1: note:   candidate expects 2 arguments, 1 provided
  /opt/ros/humble/include/tf2/tf2/LinearMath/Matrix3x3.h:618:1: note: candidate: ‘tf2::Vector3 tf2::operator*(const tf2::Vector3&, const tf2::Matrix3x3&)’
    618 | operator*(const Vector3& v, const Matrix3x3& m)
        | ^~~~~~~~
  /opt/ros/humble/include/tf2/tf2/LinearMath/Matrix3x3.h:618:1: note:   candidate expects 2 arguments, 1 provided
  /opt/ros/humble/include/tf2/tf2/LinearMath/Matrix3x3.h:624:1: note: candidate: ‘tf2::Matrix3x3 tf2::operator*(const tf2::Matrix3x3&, const tf2::Matrix3x3&)’
    624 | operator*(const Matrix3x3& m1, const Matrix3x3& m2)
        | ^~~~~~~~
  /opt/ros/humble/include/tf2/tf2/LinearMath/Matrix3x3.h:624:1: note:   candidate expects 2 arguments, 1 provided
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.cpp:182:32: error: ‘class autoware::universe_utils::PublishedTimePublisher’ has no member named ‘publish’; did you mean ‘std::map<rmw_gid_s, std::shared_ptr<rclcpp::Publisher<autoware_internal_msgs::msg::PublishedTime_<std::allocator<void> > > >, autoware::universe_utils::PublishedTimePublisher::GidCompare> autoware::universe_utils::PublishedTimePublisher::publishers_’? (not accessible from this context)
    182 |     published_time_publisher_->publish(output_object_msg.header.stamp);
        |                                ^~~~~~~
  In file included from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.hpp:21,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.cpp:15:
  /workspace/repos/autoware/install/autoware_universe_utils/include/autoware/universe_utils/ros/published_time_publisher.hpp:110:80: note: declared private here
    110 |   std::map<rmw_gid_t, rclcpp::Publisher<PublishedTime>::SharedPtr, GidCompare> publishers_;
        |                                                                                ^~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_detected_object_validation/src/lanelet_filter/lanelet_filter.cpp:191:20: error: ‘class autoware::universe_utils::StopWatch<std::chrono::duration<long int, std::ratio<1, 1000> > >’ has no member named ‘stop’
    191 |   stop_watch_ptr_->stop("objectCallback");
        |                    ^~~~
  gmake[2]: *** [CMakeFiles/object_lanelet_filter.dir/build.make:90: CMakeFiles/object_lanelet_filter.dir/src/lanelet_filter/lanelet_filter.cpp.o] Error 1
  gmake[1]: *** [CMakeFiles/Makefile2:226: CMakeFiles/object_lanelet_filter.dir/all] Error 2
  gmake: *** [Makefile:146: all] Error 2
  ---
  Failed   <<< autoware_detected_object_validation [16.5s, exited with code 2]

  Summary: 0 packages finished [17.9s]
    1 package failed: autoware_detected_object_validation
    1 package had stderr output: autoware_detected_object_validation
generate_code.cpp: |-
  void ObjectLaneletFilterNode::objectCallback(
    const autoware_perception_msgs::msg::DetectedObjects::ConstSharedPtr input_msg)
  {
    // Start performance measurement
    stop_watch_ptr_->start("objectCallback");

    // Check if input message is empty
    if (input_msg->objects.empty()) {
      RCLCPP_WARN(get_logger(), "Received empty object message");
      return;
    }

    // Transform objects to map frame
    autoware_perception_msgs::msg::DetectedObjects transformed_objects;
    try {
      autoware::object_recognition_utils::transformObjects(
        *input_msg, "map", *tf_buffer_, transformed_objects);
    } catch (const std::exception& e) {
      RCLCPP_ERROR(get_logger(), "Failed to transform objects: %s", e.what());
      return;
    }

    // Create output message
    autoware_perception_msgs::msg::DetectedObjects output_object_msg;
    output_object_msg.header = input_msg->header;

    // Create convex hull for filtering
    LinearRing2d hull = getConvexHull(transformed_objects);

    // Find intersected lanelets
    std::vector<BoxAndLanelet> intersected_lanelets = getIntersectedLanelets(hull);

    // Create R-tree for efficient spatial querying
    bg::index::rtree<BoxAndLanelet, RtreeAlgo> local_rtree;
    for (const auto& lanelet : intersected_lanelets) {
      local_rtree.insert(lanelet);
    }

    // Filter objects
    for (const auto& transformed_object : transformed_objects.objects) {
      if (filterObject(transformed_object, transformed_object, local_rtree, output_object_msg)) {
        output_object_msg.objects.push_back(transformed_object);
      }
    }

    // Publish filtered objects
    if (!output_object_msg.objects.empty()) {
      object_pub_->publish(output_object_msg);
      published_time_publisher_->publish(output_object_msg.header.stamp);
    }

    // Debug visualization if enabled
    if (filter_settings_.debug) {
      publishDebugMarkers(input_msg->header.stamp, hull, intersected_lanelets);
    }

    // Stop performance measurement
    stop_watch_ptr_->stop("objectCallback");
  }
ground_truth.cpp: |-
  void ObjectLaneletFilterNode::objectCallback(
    const autoware_perception_msgs::msg::DetectedObjects::ConstSharedPtr input_msg)
  {
    stop_watch_ptr_->tic("processing_time");

    // Guard
    if (object_pub_->get_subscription_count() < 1) return;

    autoware_perception_msgs::msg::DetectedObjects output_object_msg;
    output_object_msg.header = input_msg->header;

    if (!lanelet_map_ptr_) {
      RCLCPP_ERROR(get_logger(), "No vector map received.");
      return;
    }
    autoware_perception_msgs::msg::DetectedObjects transformed_objects;
    if (!autoware::object_recognition_utils::transformObjects(
          *input_msg, lanelet_frame_id_, tf_buffer_, transformed_objects)) {
      RCLCPP_ERROR(get_logger(), "Failed transform to %s.", lanelet_frame_id_.c_str());
      return;
    }
    // vehicle base pose :map -> base_link
    if (filter_settings_.use_height_threshold) {
      try {
        ego_base_height_ = tf_buffer_
                             .lookupTransform(
                               lanelet_frame_id_, "base_link", transformed_objects.header.stamp,
                               rclcpp::Duration::from_seconds(0.5))
                             .transform.translation.z;
      } catch (const tf2::TransformException & ex) {
        RCLCPP_ERROR_STREAM(get_logger(), "Failed to get transform: " << ex.what());
        return;
      }
    }

    if (!transformed_objects.objects.empty()) {
      // calculate convex hull
      const auto convex_hull = getConvexHull(transformed_objects);

      // get intersected lanelets
      std::vector<BoxAndLanelet> intersected_lanelets_with_bbox = getIntersectedLanelets(convex_hull);

      // create R-Tree with intersected_lanelets for fast search
      bgi::rtree<BoxAndLanelet, RtreeAlgo> local_rtree;
      for (const auto & bbox_and_lanelet : intersected_lanelets_with_bbox) {
        local_rtree.insert(bbox_and_lanelet);
      }

      if (filter_settings_.debug) {
        publishDebugMarkers(input_msg->header.stamp, convex_hull, intersected_lanelets_with_bbox);
      }
      // filtering process
      for (size_t index = 0; index < transformed_objects.objects.size(); ++index) {
        const auto & transformed_object = transformed_objects.objects.at(index);
        const auto & input_object = input_msg->objects.at(index);
        filterObject(transformed_object, input_object, local_rtree, output_object_msg);
      }
    }

    object_pub_->publish(output_object_msg);
    published_time_publisher_->publish_if_subscribed(object_pub_, output_object_msg.header.stamp);

    // Publish debug info
    const double pipeline_latency =
      std::chrono::duration<double, std::milli>(
        std::chrono::nanoseconds(
          (this->get_clock()->now() - output_object_msg.header.stamp).nanoseconds()))
        .count();
    debug_publisher_->publish<autoware_internal_debug_msgs::msg::Float64Stamped>(
      "debug/pipeline_latency_ms", pipeline_latency);
    debug_publisher_->publish<autoware_internal_debug_msgs::msg::Float64Stamped>(
      "debug/processing_time_ms", stop_watch_ptr_->toc("processing_time", true));
  }
architecture-codes:
  - ROS Timer Issues - Timestamp Processing Errors
  - Topic/Service Related Issues - Callback Function Binding Signature Mismatch
  - ROS Parameter Related Issues - Missing Dynamic Configuration Issue
functionality-codes:
  - Incomplete Code - Missing Multiple Steps
  - Conditional Checks Issues - Conditional Check Missing
  - Reference Error - Wrong Variable
  -  Domain Library Issues - Domain Specific Library Utilization Error
root-cause-codes:
  - Weakness in System-Level Integration - Lack of familiarity with the existing codebase
  - Inadequate Comprehension of Functional Logic - Inadequate Understanding of Task Logic
