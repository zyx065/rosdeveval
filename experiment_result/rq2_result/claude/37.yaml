compilation.log: |
  Starting >>> autoware_ground_segmentation
  --- stderr: autoware_ground_segmentation
  In file included from /opt/ros/humble/include/rclcpp/rclcpp/node.hpp:1321,
                   from /opt/ros/humble/include/rclcpp/rclcpp/executors/single_threaded_executor.hpp:28,
                   from /opt/ros/humble/include/rclcpp/rclcpp/executors.hpp:22,
                   from /opt/ros/humble/include/rclcpp/rclcpp/rclcpp.hpp:155,
                   from /opt/ros/humble/include/pcl_conversions/pcl_conversions/pcl_conversions.h:43,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/data.hpp:20,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.hpp:18,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:15:
  /opt/ros/humble/include/rclcpp/rclcpp/node_impl.hpp: In instantiation of ‘auto rclcpp::Node::declare_parameter(const string&, const ParameterT&, const ParameterDescriptor&, bool) [with ParameterT = long unsigned int; std::string = std::__cxx11::basic_string<char>; rcl_interfaces::msg::ParameterDescriptor = rcl_interfaces::msg::ParameterDescriptor_<std::allocator<void> >]’:
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:42:49:   required from here
  /opt/ros/humble/include/rclcpp/rclcpp/node_impl.hpp:204:15: error: call of overloaded ‘ParameterValue(const long unsigned int&)’ is ambiguous
    204 |       rclcpp::ParameterValue(default_value),
        |               ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  In file included from /opt/ros/humble/include/rclcpp/rclcpp/parameter.hpp:26,
                   from /opt/ros/humble/include/rclcpp/rclcpp/node_interfaces/node_parameters_interface.hpp:28,
                   from /opt/ros/humble/include/rclcpp/rclcpp/node.hpp:54,
                   from /opt/ros/humble/include/rclcpp/rclcpp/executors/single_threaded_executor.hpp:28,
                   from /opt/ros/humble/include/rclcpp/rclcpp/executors.hpp:22,
                   from /opt/ros/humble/include/rclcpp/rclcpp/rclcpp.hpp:155,
                   from /opt/ros/humble/include/pcl_conversions/pcl_conversions/pcl_conversions.h:43,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/data.hpp:20,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.hpp:18,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:15:
  /opt/ros/humble/include/rclcpp/rclcpp/parameter_value.hpp:94:12: note: candidate: ‘rclcpp::ParameterValue::ParameterValue(double)’
     94 |   explicit ParameterValue(const double double_value);
        |            ^~~~~~~~~~~~~~
  /opt/ros/humble/include/rclcpp/rclcpp/parameter_value.hpp:91:12: note: candidate: ‘rclcpp::ParameterValue::ParameterValue(float)’
     91 |   explicit ParameterValue(const float double_value);
        |            ^~~~~~~~~~~~~~
  /opt/ros/humble/include/rclcpp/rclcpp/parameter_value.hpp:88:12: note: candidate: ‘rclcpp::ParameterValue::ParameterValue(int64_t)’
     88 |   explicit ParameterValue(const int64_t int_value);
        |            ^~~~~~~~~~~~~~
  /opt/ros/humble/include/rclcpp/rclcpp/parameter_value.hpp:85:12: note: candidate: ‘rclcpp::ParameterValue::ParameterValue(int)’
     85 |   explicit ParameterValue(const int int_value);
        |            ^~~~~~~~~~~~~~
  /opt/ros/humble/include/rclcpp/rclcpp/parameter_value.hpp:82:12: note: candidate: ‘rclcpp::ParameterValue::ParameterValue(bool)’
     82 |   explicit ParameterValue(const bool bool_value);
        |            ^~~~~~~~~~~~~~
  /opt/ros/humble/include/rclcpp/rclcpp/parameter_value.hpp:71:7: note: candidate: ‘rclcpp::ParameterValue::ParameterValue(const rclcpp::ParameterValue&)’
     71 | class ParameterValue
        |       ^~~~~~~~~~~~~~
  /opt/ros/humble/include/rclcpp/rclcpp/parameter_value.hpp:71:7: note: candidate: ‘rclcpp::ParameterValue::ParameterValue(rclcpp::ParameterValue&&)’
  In file included from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:15:
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.hpp: In constructor ‘autoware::ground_segmentation::ScanGroundFilterComponent::ScanGroundFilterComponent(const rclcpp::NodeOptions&)’:
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.hpp:186:9: error: ‘autoware::ground_segmentation::ScanGroundFilterComponent::detection_range_z_max_’ will be initialized after [-Werror=reorder]
    186 |   float detection_range_z_max_;
        |         ^~~~~~~~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.hpp:162:9: error:   ‘float autoware::ground_segmentation::ScanGroundFilterComponent::low_priority_region_x_’ [-Werror=reorder]
    162 |   float low_priority_region_x_;
        |         ^~~~~~~~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:38:1: error:   when initialized here [-Werror=reorder]
     38 | ScanGroundFilterComponent::ScanGroundFilterComponent(const rclcpp::NodeOptions & options)
        | ^~~~~~~~~~~~~~~~~~~~~~~~~
  In file included from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:15:
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.hpp:163:9: error: ‘autoware::ground_segmentation::ScanGroundFilterComponent::center_pcl_shift_’ will be initialized after [-Werror=reorder]
    163 |   float center_pcl_shift_;  // virtual center of pcl to center mass
        |         ^~~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.hpp:161:9: error:   ‘float autoware::ground_segmentation::ScanGroundFilterComponent::non_ground_height_threshold_’ [-Werror=reorder]
    161 |   float non_ground_height_threshold_;
        |         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:38:1: error:   when initialized here [-Werror=reorder]
     38 | ScanGroundFilterComponent::ScanGroundFilterComponent(const rclcpp::NodeOptions & options)
        | ^~~~~~~~~~~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:93:43: error: ‘onSetParameters’ is not a member of ‘autoware::ground_segmentation::ScanGroundFilterComponent’
     93 |     std::bind(&ScanGroundFilterComponent::onSetParameters, this, std::placeholders::_1)
        |                                           ^~~~~~~~~~~~~~~
  In file included from /usr/include/c++/11/memory:76,
                   from /opt/ros/humble/include/sensor_msgs/sensor_msgs/msg/detail/point_cloud2__struct.hpp:10,
                   from /opt/ros/humble/include/sensor_msgs/sensor_msgs/msg/point_cloud2.hpp:7,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/data.hpp:18,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.hpp:18,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:15:
  /usr/include/c++/11/bits/unique_ptr.h: In instantiation of ‘typename std::_MakeUniq<_Tp>::__single_object std::make_unique(_Args&& ...) [with _Tp = autoware::ground_segmentation::GridGroundFilter; _Args = {bool&, float&, long unsigned int&, float&, float&, float&, float&, float&, bool&, float&, bool&, bool&, float&, float&, float&, float&, float&, float&, short unsigned int&, float&}; typename std::_MakeUniq<_Tp>::__single_object = std::unique_ptr<autoware::ground_segmentation::GridGroundFilter>]’:
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:68:63:   required from here
  /usr/include/c++/11/bits/unique_ptr.h:962:30: error: no matching function for call to ‘autoware::ground_segmentation::GridGroundFilter::GridGroundFilter(bool&, float&, long unsigned int&, float&, float&, float&, float&, float&, bool&, float&, bool&, bool&, float&, float&, float&, float&, float&, float&, short unsigned int&, float&)’
    962 |     { return unique_ptr<_Tp>(new _Tp(std::forward<_Args>(__args)...)); }
        |                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  In file included from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.hpp:19,
                   from /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/node.cpp:15:
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/grid_ground_filter.hpp:156:12: note: candidate: ‘autoware::ground_segmentation::GridGroundFilter::GridGroundFilter(autoware::ground_segmentation::GridGroundFilterParameter&)’
    156 |   explicit GridGroundFilter(GridGroundFilterParameter & param) : param_(param)
        |            ^~~~~~~~~~~~~~~~
  /workspace/repos/autoware/src/universe/autoware.universe/perception/autoware_ground_segmentation/src/scan_ground_filter/grid_ground_filter.hpp:156:12: note:   candidate expects 1 argument, 20 provided
  cc1plus: all warnings being treated as errors
  gmake[2]: *** [CMakeFiles/autoware_ground_segmentation.dir/build.make:104: CMakeFiles/autoware_ground_segmentation.dir/src/scan_ground_filter/node.cpp.o] Error 1
  gmake[1]: *** [CMakeFiles/Makefile2:167: CMakeFiles/autoware_ground_segmentation.dir/all] Error 2
  gmake: *** [Makefile:146: all] Error 2
  ---
  Failed   <<< autoware_ground_segmentation [11.4s, exited with code 2]

  Summary: 0 packages finished [12.9s]
    1 package failed: autoware_ground_segmentation
    1 package had stderr output: autoware_ground_segmentation
generate_code.cpp: |-
  ScanGroundFilterComponent::ScanGroundFilterComponent(const rclcpp::NodeOptions & options)
  : autoware::pointcloud_preprocessor::Filter("ScanGroundFilter", options),
    elevation_grid_mode_(declare_parameter<bool>("elevation_grid_mode", false)),
    radial_divider_angle_rad_(declare_parameter<float>("radial_divider_angle_rad", 0.1)),
    radial_dividers_num_(declare_parameter<size_t>("radial_dividers_num", 16)),
    global_slope_max_angle_rad_(declare_parameter<float>("global_slope_max_angle_rad", 0.1)),
    local_slope_max_angle_rad_(declare_parameter<float>("local_slope_max_angle_rad", 0.1)),
    global_slope_max_ratio_(declare_parameter<float>("global_slope_max_ratio", 1.0)),
    local_slope_max_ratio_(declare_parameter<float>("local_slope_max_ratio", 1.0)),
    split_points_distance_tolerance_(declare_parameter<float>("split_points_distance_tolerance", 0.1)),
    use_virtual_ground_point_(declare_parameter<bool>("use_virtual_ground_point", false)),
    split_height_distance_(declare_parameter<float>("split_height_distance", 0.2)),
    use_recheck_ground_cluster_(declare_parameter<bool>("use_recheck_ground_cluster", false)),
    use_lowest_point_(declare_parameter<bool>("use_lowest_point", false)),
    detection_range_z_max_(declare_parameter<float>("detection_range_z_max", 2.0)),
    low_priority_region_x_(declare_parameter<float>("low_priority_region_x", 0.5)),
    center_pcl_shift_(declare_parameter<float>("center_pcl_shift", 0.0)),
    non_ground_height_threshold_(declare_parameter<float>("non_ground_height_threshold", 0.2)),
    grid_size_m_(declare_parameter<float>("grid_size_m", 0.25)),
    grid_mode_switch_radius_(declare_parameter<float>("grid_mode_switch_radius", 10.0)),
    gnd_grid_buffer_size_(declare_parameter<uint16_t>("gnd_grid_buffer_size", 10)),
    virtual_lidar_z_(declare_parameter<float>("virtual_lidar_z", 0.0))
  {
    // Initialize debug publisher and stop watch if needed
    if (get_parameter("enable_debug").as_bool()) {
      debug_publisher_ptr_ = std::make_unique<autoware::universe_utils::DebugPublisher>(this, "ground_filter");
      stop_watch_ptr_ = std::make_unique<autoware::universe_utils::StopWatch<std::chrono::milliseconds>>();
    }

    // Initialize grid ground filter
    grid_ground_filter_ptr_ = std::make_unique<GridGroundFilter>(
      elevation_grid_mode_,
      radial_divider_angle_rad_,
      radial_dividers_num_,
      global_slope_max_angle_rad_,
      local_slope_max_angle_rad_,
      global_slope_max_ratio_,
      local_slope_max_ratio_,
      split_points_distance_tolerance_,
      use_virtual_ground_point_,
      split_height_distance_,
      use_recheck_ground_cluster_,
      use_lowest_point_,
      detection_range_z_max_,
      low_priority_region_x_,
      center_pcl_shift_,
      non_ground_height_threshold_,
      grid_size_m_,
      grid_mode_switch_radius_,
      gnd_grid_buffer_size_,
      virtual_lidar_z_
    );

    // Setup parameter callback
    set_param_res_ = this->add_on_set_parameters_callback(
      std::bind(&ScanGroundFilterComponent::onSetParameters, this, std::placeholders::_1)
    );
  }
ground_truth.cpp: |-
  ScanGroundFilterComponent::ScanGroundFilterComponent(const rclcpp::NodeOptions & options)
  : autoware::pointcloud_preprocessor::Filter("ScanGroundFilter", options)
  {
    // set initial parameters
    {
      // modes
      elevation_grid_mode_ = declare_parameter<bool>("elevation_grid_mode");

      // common parameters
      radial_divider_angle_rad_ =
        static_cast<float>(deg2rad(declare_parameter<double>("radial_divider_angle_deg")));
      radial_dividers_num_ = std::ceil(2.0 * M_PI / radial_divider_angle_rad_);

      // common thresholds
      global_slope_max_angle_rad_ =
        static_cast<float>(deg2rad(declare_parameter<double>("global_slope_max_angle_deg")));
      local_slope_max_angle_rad_ =
        static_cast<float>(deg2rad(declare_parameter<double>("local_slope_max_angle_deg")));
      global_slope_max_ratio_ = std::tan(global_slope_max_angle_rad_);
      local_slope_max_ratio_ = std::tan(local_slope_max_angle_rad_);
      split_points_distance_tolerance_ =
        static_cast<float>(declare_parameter<double>("split_points_distance_tolerance"));

      // vehicle info
      vehicle_info_ = VehicleInfoUtils(*this).getVehicleInfo();

      // non-grid parameters
      use_virtual_ground_point_ = declare_parameter<bool>("use_virtual_ground_point");
      split_height_distance_ = static_cast<float>(declare_parameter<double>("split_height_distance"));

      // grid mode parameters
      use_recheck_ground_cluster_ = declare_parameter<bool>("use_recheck_ground_cluster");
      use_lowest_point_ = declare_parameter<bool>("use_lowest_point");
      detection_range_z_max_ = static_cast<float>(declare_parameter<double>("detection_range_z_max"));
      low_priority_region_x_ = static_cast<float>(declare_parameter<double>("low_priority_region_x"));
      center_pcl_shift_ = static_cast<float>(declare_parameter<double>("center_pcl_shift"));
      non_ground_height_threshold_ =
        static_cast<float>(declare_parameter<double>("non_ground_height_threshold"));

      // grid parameters
      grid_size_m_ = static_cast<float>(declare_parameter<double>("grid_size_m"));
      grid_mode_switch_radius_ =
        static_cast<float>(declare_parameter<double>("grid_mode_switch_radius"));
      gnd_grid_buffer_size_ = declare_parameter<int>("gnd_grid_buffer_size");
      virtual_lidar_z_ = vehicle_info_.vehicle_height_m;

      // initialize grid filter
      {
        GridGroundFilterParameter param;
        param.global_slope_max_angle_rad = global_slope_max_angle_rad_;
        param.local_slope_max_angle_rad = local_slope_max_angle_rad_;
        param.radial_divider_angle_rad = radial_divider_angle_rad_;

        param.use_recheck_ground_cluster = use_recheck_ground_cluster_;
        param.use_lowest_point = use_lowest_point_;
        param.detection_range_z_max = detection_range_z_max_;
        param.non_ground_height_threshold = non_ground_height_threshold_;

        param.grid_size_m = grid_size_m_;
        param.grid_mode_switch_radius = grid_mode_switch_radius_;
        param.gnd_grid_buffer_size = gnd_grid_buffer_size_;
        param.virtual_lidar_x = vehicle_info_.wheel_base_m / 2.0f + center_pcl_shift_;
        param.virtual_lidar_y = 0.0f;
        param.virtual_lidar_z = virtual_lidar_z_;

        grid_ground_filter_ptr_ = std::make_unique<GridGroundFilter>(param);
      }
    }

    using std::placeholders::_1;
    set_param_res_ = this->add_on_set_parameters_callback(
      std::bind(&ScanGroundFilterComponent::onParameter, this, _1));

    // initialize debug tool
    {
      using autoware::universe_utils::DebugPublisher;
      using autoware::universe_utils::StopWatch;
      stop_watch_ptr_ = std::make_unique<StopWatch<std::chrono::milliseconds>>();
      debug_publisher_ptr_ = std::make_unique<DebugPublisher>(this, "scan_ground_filter");
      stop_watch_ptr_->tic("cyclic_time");
      stop_watch_ptr_->tic("processing_time");

      bool use_time_keeper = declare_parameter<bool>("publish_processing_time_detail");
      if (use_time_keeper) {
        detailed_processing_time_publisher_ =
          this->create_publisher<autoware::universe_utils::ProcessingTimeDetail>(
            "~/debug/processing_time_detail_ms", 1);
        auto time_keeper = autoware::universe_utils::TimeKeeper(detailed_processing_time_publisher_);
        time_keeper_ = std::make_shared<autoware::universe_utils::TimeKeeper>(time_keeper);

        // set time keeper to grid
        grid_ground_filter_ptr_->setTimeKeeper(time_keeper_);
      }
    }
  }
architecture-codes:
  - ROS Parameter Related Issues - Use Non-exist Parameter
  - ROS Parameter Related Issues - Parameter Type Mismatch
  - ROS Parameter Related Issues - Insufficient Parameter Design
functionality-codes:
  - Incomplete Code - Missing Multiple Steps
  - Reference Error - Undefined method
  - Constant Value Error
root-cause-codes:
  - Deficiencies in Domain Knowledge - Insufficient understanding of ROS Programming
  - Deficiencies in Domain Knowledge - Lack of ROS development best practices
  - Weakness in System-Level Integration - Lack of familiarity with the existing codebase