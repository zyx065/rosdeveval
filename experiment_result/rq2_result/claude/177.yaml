compilation.log: |
  Starting >>> nav2_velocity_smoother
  --- stderr: nav2_velocity_smoother
  /root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp: In member function ‘virtual nav2_util::CallbackReturn nav2_velocity_smoother::VelocitySmoother::on_configure(const rclcpp_lifecycle::State&)’:
  /root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:96:38: error: ‘publishVelocity’ is not a member of ‘nav2_velocity_smoother::VelocitySmoother’
     96 |         std::bind(&VelocitySmoother::publishVelocity, this)
        |                                      ^~~~~~~~~~~~~~~
  In file included from /usr/include/c++/11/memory:76,
                   from /root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:17:
  /usr/include/c++/11/bits/unique_ptr.h: In instantiation of ‘typename std::_MakeUniq<_Tp>::__single_object std::make_unique(_Args&& ...) [with _Tp = nav2_util::OdomSmoother; _Args = {nav2_velocity_smoother::VelocitySmoother*, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >&, rclcpp::Duration}; typename std::_MakeUniq<_Tp>::__single_object = std::unique_ptr<nav2_util::OdomSmoother>]’:
  /root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:101:67:   required from here
  /usr/include/c++/11/bits/unique_ptr.h:962:30: error: no matching function for call to ‘nav2_util::OdomSmoother::OdomSmoother(nav2_velocity_smoother::VelocitySmoother*, std::__cxx11::basic_string<char>&, rclcpp::Duration)’
    962 |     { return unique_ptr<_Tp>(new _Tp(std::forward<_Args>(__args)...)); }
        |                              ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  In file included from /root/repos/nav_ws/src/nav2_velocity_smoother/include/nav2_velocity_smoother/velocity_smoother.hpp:27,
                   from /root/repos/nav_ws/src/nav2_velocity_smoother/src/velocity_smoother.cpp:22:
  /root/repos/nav_ws/install/nav2_util/include/nav2_util/odometry_utils.hpp:62:12: note: candidate: ‘nav2_util::OdomSmoother::OdomSmoother(const WeakPtr&, double, const string&)’
     62 |   explicit OdomSmoother(
        |            ^~~~~~~~~~~~
  /root/repos/nav_ws/install/nav2_util/include/nav2_util/odometry_utils.hpp:63:47: note:   no known conversion for argument 1 from ‘nav2_velocity_smoother::VelocitySmoother*’ to ‘const WeakPtr&’ {aka ‘const std::weak_ptr<rclcpp_lifecycle::LifecycleNode>&’}
     63 |     const nav2_util::LifecycleNode::WeakPtr & parent,
        |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~
  /root/repos/nav_ws/install/nav2_util/include/nav2_util/odometry_utils.hpp:50:12: note: candidate: ‘nav2_util::OdomSmoother::OdomSmoother(const WeakPtr&, double, const string&)’
     50 |   explicit OdomSmoother(
        |            ^~~~~~~~~~~~
  /root/repos/nav_ws/install/nav2_util/include/nav2_util/odometry_utils.hpp:51:35: note:   no known conversion for argument 1 from ‘nav2_velocity_smoother::VelocitySmoother*’ to ‘const WeakPtr&’ {aka ‘const std::weak_ptr<rclcpp::Node>&’}
     51 |     const rclcpp::Node::WeakPtr & parent,
        |     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~
  gmake[2]: *** [CMakeFiles/velocity_smoother_core.dir/build.make:76: CMakeFiles/velocity_smoother_core.dir/src/velocity_smoother.cpp.o] Error 1
  gmake[1]: *** [CMakeFiles/Makefile2:174: CMakeFiles/velocity_smoother_core.dir/all] Error 2
  gmake: *** [Makefile:146: all] Error 2
  ---
  Failed   <<< nav2_velocity_smoother [3.99s, exited with code 2]

  Summary: 0 packages finished [4.30s]
    1 package failed: nav2_velocity_smoother
    1 package had stderr output: nav2_velocity_smoother
generate_code.cpp: |-
  nav2_util::CallbackReturn
  VelocitySmoother::on_configure(const rclcpp_lifecycle::State &)
  {
      // Declare parameters with default values
      declare_parameter("smoothing_frequency", 20.0);
      declare_parameter("scale_velocities", true);
      declare_parameter("max_velocity", std::vector<double>{1.0, 1.0, 1.0});
      declare_parameter("min_velocity", std::vector<double>{-1.0, -1.0, -1.0});
      declare_parameter("max_accel", std::vector<double>{1.0, 1.0, 1.0});
      declare_parameter("max_decel", std::vector<double>{1.0, 1.0, 1.0});
      declare_parameter("deadband_velocity", std::vector<double>{0.1, 0.1, 0.1});
      declare_parameter("open_loop", false);
      declare_parameter("odom_topic", std::string("odom"));
      declare_parameter("odom_duration", 0.1);
      declare_parameter("velocity_timeout", 1.0);

      // Retrieve parameter values
      get_parameter("smoothing_frequency", smoothing_frequency_);
      get_parameter("scale_velocities", scale_velocities_);
      get_parameter("max_velocity", max_velocities_);
      get_parameter("min_velocity", min_velocities_);
      get_parameter("max_accel", max_accels_);
      get_parameter("max_decel", max_decels_);
      get_parameter("deadband_velocity", deadband_velocities_);
      get_parameter("open_loop", open_loop_);
      get_parameter("odom_topic", odom_topic_);
      get_parameter("odom_duration", odom_duration_);

      // Configure velocity timeout
      double velocity_timeout;
      get_parameter("velocity_timeout", velocity_timeout);
      velocity_timeout_ = rclcpp::Duration::from_seconds(velocity_timeout);

      // Initialize clock
      clock_ = std::make_shared<rclcpp::Clock>(RCL_ROS_TIME);

      // Create command velocity subscriber
      cmd_sub_ = create_subscription<geometry_msgs::msg::Twist>(
          "cmd_vel", rclcpp::SystemDefaultsQoS(),
          std::bind(&VelocitySmoother::inputCommandCallback, this, std::placeholders::_1)
      );

      // Create smoothed command velocity publisher
      smoothed_cmd_pub_ = create_publisher<geometry_msgs::msg::Twist>(
          "cmd_vel_smoothed", rclcpp::SystemDefaultsQoS()
      );

      // Initialize timer for velocity smoothing
      timer_ = create_wall_timer(
          std::chrono::duration<double>(1.0 / smoothing_frequency_),
          std::bind(&VelocitySmoother::publishVelocity, this)
      );

      // Initialize odom smoother if not in open loop mode
      if (!open_loop_) {
          odom_smoother_ = std::make_unique<nav2_util::OdomSmoother>(
              this, odom_topic_, rclcpp::Duration::from_seconds(odom_duration_)
          );
      }

      // Reset state
      stopped_ = true;
      last_command_time_ = clock_->now();

      return nav2_util::CallbackReturn::SUCCESS;
  }
ground_truth.cpp: |-
  nav2_util::CallbackReturn
  VelocitySmoother::on_configure(const rclcpp_lifecycle::State &)
  {
    RCLCPP_INFO(get_logger(), "Configuring velocity smoother");
    auto node = shared_from_this();
    std::string feedback_type;
    double velocity_timeout_dbl;

    // Smoothing metadata
    declare_parameter_if_not_declared(node, "smoothing_frequency", rclcpp::ParameterValue(20.0));
    declare_parameter_if_not_declared(
      node, "feedback", rclcpp::ParameterValue(std::string("OPEN_LOOP")));
    declare_parameter_if_not_declared(node, "scale_velocities", rclcpp::ParameterValue(false));
    node->get_parameter("smoothing_frequency", smoothing_frequency_);
    node->get_parameter("feedback", feedback_type);
    node->get_parameter("scale_velocities", scale_velocities_);

    // Kinematics
    declare_parameter_if_not_declared(
      node, "max_velocity", rclcpp::ParameterValue(std::vector<double>{0.50, 0.0, 2.5}));
    declare_parameter_if_not_declared(
      node, "min_velocity", rclcpp::ParameterValue(std::vector<double>{-0.50, 0.0, -2.5}));
    declare_parameter_if_not_declared(
      node, "max_accel", rclcpp::ParameterValue(std::vector<double>{2.5, 0.0, 3.2}));
    declare_parameter_if_not_declared(
      node, "max_decel", rclcpp::ParameterValue(std::vector<double>{-2.5, 0.0, -3.2}));
    node->get_parameter("max_velocity", max_velocities_);
    node->get_parameter("min_velocity", min_velocities_);
    node->get_parameter("max_accel", max_accels_);
    node->get_parameter("max_decel", max_decels_);

    for (unsigned int i = 0; i != 3; i++) {
      if (max_decels_[i] > 0.0) {
        throw std::runtime_error(
                "Positive values set of deceleration! These should be negative to slow down!");
      }
      if (max_accels_[i] < 0.0) {
        throw std::runtime_error(
                "Negative values set of acceleration! These should be positive to speed up!");
      }
      if (min_velocities_[i] > max_velocities_[i]) {
        throw std::runtime_error(
                "Min velocities are higher than max velocities!");
      }
    }

    // Get feature parameters
    declare_parameter_if_not_declared(node, "odom_topic", rclcpp::ParameterValue("odom"));
    declare_parameter_if_not_declared(node, "odom_duration", rclcpp::ParameterValue(0.1));
    declare_parameter_if_not_declared(
      node, "deadband_velocity", rclcpp::ParameterValue(std::vector<double>{0.0, 0.0, 0.0}));
    declare_parameter_if_not_declared(node, "velocity_timeout", rclcpp::ParameterValue(1.0));
    node->get_parameter("odom_topic", odom_topic_);
    node->get_parameter("odom_duration", odom_duration_);
    node->get_parameter("deadband_velocity", deadband_velocities_);
    node->get_parameter("velocity_timeout", velocity_timeout_dbl);
    velocity_timeout_ = rclcpp::Duration::from_seconds(velocity_timeout_dbl);

    if (max_velocities_.size() != 3 || min_velocities_.size() != 3 ||
      max_accels_.size() != 3 || max_decels_.size() != 3 || deadband_velocities_.size() != 3)
    {
      throw std::runtime_error(
              "Invalid setting of kinematic and/or deadband limits!"
              " All limits must be size of 3 representing (x, y, theta).");
    }

    // Get control type
    if (feedback_type == "OPEN_LOOP") {
      open_loop_ = true;
    } else if (feedback_type == "CLOSED_LOOP") {
      open_loop_ = false;
      odom_smoother_ = std::make_unique<nav2_util::OdomSmoother>(node, odom_duration_, odom_topic_);
    } else {
      throw std::runtime_error("Invalid feedback_type, options are OPEN_LOOP and CLOSED_LOOP.");
    }

    // Setup inputs / outputs
    smoothed_cmd_pub_ = create_publisher<geometry_msgs::msg::Twist>("cmd_vel_smoothed", 1);
    cmd_sub_ = create_subscription<geometry_msgs::msg::Twist>(
      "cmd_vel", rclcpp::QoS(1),
      std::bind(&VelocitySmoother::inputCommandCallback, this, std::placeholders::_1));

    return nav2_util::CallbackReturn::SUCCESS;
  }
architecture-codes:
  - Topic/Service Related Issues - QoS Policy Incompatibility
  - ROS Parameter Related Issues - Insufficient Parameter Design
  - ROS Parameter Related Issues - Use Non-exist Parameter
  - ROS Parameter Related Issues - Parameter Type Mismatch
  - ROS Parameter Related Issues - Missing Best Practice
  - ROS Logger Issues - ROS Logger Missing Issue
  - ROS Timer Issues - Timer Creation Error
functionality-codes:
  - Conditional Checks Issues - Conditional Check Missing
  - Reference Error - Wrong method
  - Reference Error - Wrong Variable
  - Incomplete Code - Missing Multiple Steps
Root Cause Analysis:
  - Inadequate Comprehension of Functional Logic - Inadequate Understanding of Task Logic
  - Inadequate Comprehension of Functional Logic - Inadequate Understanding of System Requirements
  - Deficiencies in Domain Knowledge - Insufficient understanding of ROS Programming
  - Deficiencies in Domain Knowledge - Lack of ROS development best practices
  - Weakness in System-Level Integration - Lack of familiarity with the existing codebase
