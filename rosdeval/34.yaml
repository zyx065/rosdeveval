repository: autoware
language: C++
ros_package_file: src/universe/autoware.universe/perception/autoware_detected_object_validation
ros_package: autoware_detected_object_validation
file_path: src/lanelet_filter/lanelet_filter.cpp
method_name: ObjectLaneletFilterNode::objectCallback
requirement: |
  /**
  * @brief Filters detected objects based on their intersection with lanelets in the vector map.
  * 
  * Transforms input objects into the lanelet frame and filters them by checking which lanelets
  * they intersect with, publishing only objects that meet the lanelet intersection criteria.
  * 
  * @param input_msg Shared pointer to the input detected objects message.
  */
category: ros_architecture
type: has_message,has_topic,has_logger,has_timer,has_domain_library,has_parameter
signature: |
  void ObjectLaneletFilterNode::objectCallback(
    const autoware_perception_msgs::msg::DetectedObjects::ConstSharedPtr input_msg)
additional_information: 
  function_related_variable: |
    std::unique_ptr<autoware::universe_utils::StopWatch<std::chrono::milliseconds>> stop_watch_ptr_;
    rclcpp::Publisher<autoware_perception_msgs::msg::DetectedObjects>::SharedPtr object_pub_;
    lanelet::LaneletMapPtr lanelet_map_ptr_;
    struct FilterSettings
    {
      bool polygon_overlap_filter;
      bool lanelet_direction_filter;
      double lanelet_direction_filter_velocity_yaw_threshold;
      double lanelet_direction_filter_object_speed_threshold;
      bool debug;
      double lanelet_extra_margin;
    } filter_settings_;
    rclcpp::Publisher<autoware_perception_msgs::msg::DetectedObjects>::SharedPtr object_pub_;
    std::unique_ptr<autoware::universe_utils::PublishedTimePublisher> published_time_publisher_;
    std::unique_ptr<autoware::universe_utils::DebugPublisher> debug_publisher_{nullptr};
  function_related_function: |
    LinearRing2d getConvexHull(const autoware_perception_msgs::msg::DetectedObjects &);
    std::vector<BoxAndLanelet> getIntersectedLanelets(const LinearRing2d &);
    void publishDebugMarkers(rclcpp::Time stamp, const LinearRing2d & hull, const std::vector<BoxAndLanelet> & lanelets);
    bool filterObject(
      const autoware_perception_msgs::msg::DetectedObject & transformed_object,
      const autoware_perception_msgs::msg::DetectedObject & input_object,
      const bg::index::rtree<BoxAndLanelet, RtreeAlgo> & local_rtree,
      autoware_perception_msgs::msg::DetectedObjects & output_object_msg);
  function_related_class: |
    autoware::object_recognition_utils::transformObjects(  const T & input_msg, const std::string & target_frame_id, const tf2_ros::Buffer & tf_buffer,T & output_msg)
test: object_lanelet_filter_tests
test_cases: []